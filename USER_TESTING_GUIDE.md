# PDF范本自动填充 - 用户测试指南

## 🎯 功能概述

**功能名称**: PDF范本自动填充  
**适用项目**: 使用PDF格式招标文件的项目（如"测试1"）  
**成功率**: 87.5% (7/8节点)  
**处理时间**: 3-5秒  

---

## 📋 测试步骤

### 步骤1: 准备项目

1. 登录系统（账号: `admin`, 密码: `admin123`）
2. 选择"测试1"项目（或任何上传了PDF招标文件的项目）
3. 确认项目已生成目录（如果没有，先点击"生成目录"）

---

### 步骤2: 执行自动填充

1. 在项目界面，找到**"自动填充范本"**按钮
2. 点击按钮
3. 等待3-5秒
4. 观察界面提示

**预期结果**:
- ✅ 显示成功消息（如"已成功填充7个章节"）
- ✅ 目录树中的节点状态更新（显示已填充）

---

### 步骤3: 查看填充内容

#### 方法A: 在目录树中查看

1. 在左侧目录树中，点击任一节点（如"1. 开标一览表"）
2. 右侧内容区会显示该节点的正文

**预期内容**:
- ✅ 表格应完整显示（保留原始格式）
- ✅ 文字内容应清晰可读
- ✅ 底部显示黄色提示："💡 该章节已挂载范本"

#### 方法B: 在内容预览模式查看

1. 切换到"内容"标签页
2. 滚动查看所有章节
3. 每个章节都应该显示其对应的内容

---

### 步骤4: 验证具体节点

根据"测试1"项目，以下节点应成功填充：

| 序号 | 节点标题 | 预期内容类型 | 验证要点 |
|-----|---------|-------------|---------|
| 1 | 开标一览表 | 表格 | ✅ 包含"项目名称"、"总投标价"等列 |
| 2 | 投标函 | 文本 | ✅ 包含投标承诺和声明文字 |
| 3 | 货物报价一览表 | 表格 | ✅ 包含货物明细和价格 |
| 4 | 对商务要求及合同条款的响应 | 表格/文本 | ✅ 包含响应内容 |
| 5 | 对技术要求的响应 | 表格/文本 | ✅ 包含技术响应内容 |
| 6 | 货物服务技术方案 | 文本 | ✅ 包含技术方案描述 |
| 7 | 法定代表人身份证明及授权委托书 | 表格/文本 | ✅ 包含身份证明表格 |
| 8 | 各类资质证书及其他重要资料 | - | ❌ 可能未填充（正常） |

---

## 🔧 故障排查

### 问题1: 按钮点击后无反应

**可能原因**:
- 项目未上传PDF招标文件
- 项目未生成目录

**解决方法**:
1. 检查项目资产列表，确认有PDF文件
2. 先点击"生成目录"
3. 等待目录生成完成后再点击"自动填充范本"

---

### 问题2: 提示"未抽取到范本"

**可能原因**:
- PDF文件是扫描件（无可复制文字）
- PDF文件不包含标准的投标文件格式

**解决方法**:
1. 检查PDF文件是否可以复制文字
2. 如果是扫描件，建议使用可编辑的DOCX文件
3. 查看后端日志获取详细错误信息：
   ```bash
   cd /aidata/x-llmapp1
   ./diagnose_fragments.sh [项目ID]
   ```

---

### 问题3: 部分节点未填充

**原因**: 这是正常现象，系统采用智能匹配，置信度低于40%的节点不会填充

**解决方法**:
- 对于未填充的节点，可以手动编辑
- 或者检查PDF原文是否包含对应内容

---

### 问题4: 填充内容显示为空

**可能原因**:
- 后端API错误（已在2025-12-26修复）
- 浏览器缓存

**解决方法**:
1. 刷新页面（Ctrl+F5 / Cmd+Shift+R）
2. 清除浏览器缓存
3. 检查浏览器控制台是否有错误（F12 → Console）
4. 检查后端日志：
   ```bash
   docker-compose logs backend --tail=50 | grep "PDF_SEMANTIC_MATCH"
   ```

---

## 📊 预期结果展示

### 成功填充的表格示例

```
┌────────────────────────────────────────┐
│          开标一览表                     │
├─────────┬──────────────────────────────┤
│ 项目名称 │ XXX采购项目                  │
├─────────┼──────────────────────────────┤
│总投标价  │ 大写：壹佰万元整              │
│         │ 小写：¥1,000,000.00          │
└─────────┴──────────────────────────────┘
```

### 成功填充的文本示例

```
投标函

致：XXX采购代理机构

我方响应贵方XXX项目的招标文件，经研究招标文件和
有关资料后，我方愿意按照招标文件的要求...

（后续详细内容）
```

---

## 💡 使用建议

1. **优先使用可编辑的PDF**
   - 文字可复制的PDF效果最好
   - 避免使用扫描件

2. **验证关键节点**
   - 重点检查"开标一览表"、"投标函"等核心节点
   - 确保表格格式正确

3. **及时保存**
   - 填充完成后可以编辑
   - 编辑后会自动保存

4. **导出前预览**
   - 导出文档前先在"内容"模式下预览
   - 确保所有内容符合要求

---

## 📞 技术支持

如果遇到问题，请提供以下信息：

1. **项目名称**: 如"测试1"
2. **错误消息**: 界面显示的错误提示
3. **后端日志**: 运行诊断脚本的输出
   ```bash
   cd /aidata/x-llmapp1
   ./diagnose_fragments.sh [项目ID]
   ```
4. **截图**: 问题界面的截图

---

## 📚 相关文档

- **技术实现**: `PDF_SEMANTIC_SEARCH_FINAL.md`
- **修复日志**: `HOTFIX_2025-12-26.md`
- **开发文档**: `PLAN_A_C_IMPLEMENTATION.md`

---

**最后更新**: 2025-12-26 03:37 UTC+8  
**功能状态**: ✅ 已部署并修复所有已知问题  
**建议操作**: 可以开始使用测试

