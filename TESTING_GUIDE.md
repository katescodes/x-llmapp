# 自动填充功能增强 - 测试指南

**测试版本**: v1.0（2025-12-25）  
**测试目标**: 验证增强的自动填充功能是否正常工作

---

## 🎯 测试目标

验证以下功能点：
1. ✅ 规则匹配准确率提升（75-80% → 90-95%）
2. ✅ LLM兜底成功率（处理规则无法匹配的cases）
3. ✅ 一键完成（生成目录 + 自动填充）
4. ✅ 向后兼容（现有功能不受影响）
5. ✅ 性能在可接受范围（< 60秒）

---

## 🧪 测试环境

- **后端**: http://localhost:8000
- **前端**: http://localhost:5173
- **用户**: admin / admin123
- **Docker容器**: localgpt-backend（已重启）

---

## 📋 测试用例

### 测试1: 基础功能验证（必测）

**目标**: 验证"生成目录"自动调用填充

**步骤**:
1. 登录前端界面（admin/admin123）
2. 创建新项目或选择现有项目
3. 上传招标书（DOCX格式，包含投标文件格式章节）
4. 点击"生成目录"按钮
5. 等待完成（约30-60秒）
6. 查看目录节点

**预期结果**:
- ✅ 目录生成成功
- ✅ 部分节点自动填充（显示"已填充"标识）
- ✅ 填充节点数 ≥ 30%（假设30个节点，至少10个填充）
- ✅ 填充内容正确（点击节点查看正文）

**判断标准**:
```
填充准确率 = 正确填充的节点数 / 总填充节点数
预期: ≥ 90%
```

---

### 测试2: 规则匹配验证

**目标**: 验证规则匹配的4层策略

**测试用例**:

| 节点标题 | 预期匹配方式 | 预期置信度 | 预期结果 |
|---------|-------------|-----------|---------|
| "投标函" | 完全匹配 | 1.0 | ✅ 匹配成功 |
| "投标书" | 同义词匹配 | 0.8 | ✅ 匹配成功 |
| "法定代表人授权委托书" | 包含匹配 | 0.9 | ✅ 匹配成功 |
| "投标报价一览表" | 包含匹配 | 0.9 | ✅ 匹配成功 |
| "技术响应偏离表" | 模糊匹配 | 0.7 | ✅ 匹配成功 |

**验证方式**:
```bash
# 查看后端日志
docker-compose logs backend | grep "OutlineSampleAttacher" | tail -50

# 查找关键信息：
# - "matched by rules (confidence: X.XX)"
# - "matched by LLM"
```

---

### 测试3: LLM兜底验证

**目标**: 验证LLM处理复杂标题

**测试用例**:

| 节点标题 | 规则匹配 | LLM匹配 | 预期结果 |
|---------|---------|---------|---------|
| "项目实施方案及技术响应承诺" | 失败（< 0.6） | 成功（≥ 80） | ✅ 通过LLM匹配 |
| "投标文件真实性声明函" | 部分（0.7） | 成功（≥ 85） | ✅ 通过LLM匹配 |
| "法授书"（缩写） | 失败 | 成功 | ✅ 通过LLM匹配 |

**验证方式**:
```bash
# 查看LLM调用日志
docker-compose logs backend | grep "LLMFragmentMatcher" | tail -20

# 查找关键信息：
# - "using LLM fallback"
# - "matched by LLM"
# - "score: XX"
```

---

### 测试4: 性能验证

**目标**: 验证性能在可接受范围

**测试场景**:
- 30个目录节点
- 15个格式文档
- 混合匹配策略

**测试步骤**:
1. 记录开始时间
2. 点击"生成目录"
3. 记录完成时间
4. 计算总耗时

**预期结果**:
- ✅ 总耗时 < 60秒
- ✅ 规则匹配：< 1秒（70% cases）
- ✅ LLM匹配：2-3秒/批（20-30% cases）

**验证方式**:
```bash
# 查看日志中的时间戳
docker-compose logs backend | grep "generate_directory"
```

---

### 测试5: 向后兼容验证

**目标**: 验证现有功能不受影响

**测试步骤**:
1. 点击"自动填充范本"按钮（独立按钮）
2. 等待完成
3. 查看填充结果

**预期结果**:
- ✅ 功能正常（仍然可用）
- ✅ 填充结果与"生成目录"一致
- ✅ 不影响已有用户内容

---

### 测试6: 边界情况验证

**目标**: 验证异常处理

**测试用例**:

| 场景 | 预期行为 | 验证方式 |
|------|---------|---------|
| 无招标书（DOCX不存在） | 使用内置范本库 | 查看日志："使用内置范本库" |
| 无格式文档（提取失败） | 使用内置范本库 | 查看日志："未能抽取到范本片段" |
| 目录节点为空 | 正常返回 | 不报错 |
| LLM超时/失败 | 降级到规则匹配 | 查看日志："LLM match failed" |

---

## 📊 测试报告模板

### 测试结果

| 测试用例 | 状态 | 准确率 | 耗时 | 备注 |
|---------|------|--------|------|------|
| 测试1: 基础功能 | ⏳ | - | - | - |
| 测试2: 规则匹配 | ⏳ | - | - | - |
| 测试3: LLM兜底 | ⏳ | - | - | - |
| 测试4: 性能 | ⏳ | - | - | - |
| 测试5: 向后兼容 | ⏳ | - | - | - |
| 测试6: 边界情况 | ⏳ | - | - | - |

### 整体评估

| 指标 | 目标 | 实际 | 达成 |
|------|------|------|------|
| 匹配准确率 | ≥ 90% | ? | ⏳ |
| 填充覆盖率 | ≥ 30% | ? | ⏳ |
| 总耗时 | < 60秒 | ? | ⏳ |
| 用户体验 | 1次点击 | ? | ⏳ |

---

## 🐛 问题记录

### 发现的问题

| 问题ID | 描述 | 严重程度 | 状态 |
|--------|------|---------|------|
| - | - | - | - |

### 改进建议

| 建议 | 优先级 | 预期效果 |
|------|--------|---------|
| - | - | - |

---

## 🔍 日志查看命令

```bash
# 1. 实时查看所有相关日志
docker-compose logs -f backend | grep -E "(generate_directory|OutlineSampleAttacher|LLMFragmentMatcher|auto_fill_samples)"

# 2. 查看匹配详情
docker-compose logs backend | grep "OutlineSampleAttacher" | tail -100

# 3. 查看LLM调用
docker-compose logs backend | grep "LLMFragmentMatcher" | tail -50

# 4. 查看错误
docker-compose logs backend | grep "ERROR" | tail -50

# 5. 查看目录生成流程
docker-compose logs backend | grep "generate_directory" | tail -100
```

---

## ✅ 测试通过标准

1. ✅ 所有测试用例通过
2. ✅ 匹配准确率 ≥ 90%
3. ✅ 填充覆盖率 ≥ 30%
4. ✅ 性能 < 60秒
5. ✅ 无严重bug
6. ✅ 向后兼容

---

## 🚀 下一步

**如果测试通过**:
- ✅ 标记为生产就绪
- ✅ 更新用户文档
- ✅ 通知用户新功能

**如果测试失败**:
- 🐛 记录问题
- 🔧 修复代码
- 🔄 重新测试

---

**测试指南版本**: v1.0  
**创建时间**: 2025-12-25  
**适用版本**: 自动填充功能增强 v1.0
