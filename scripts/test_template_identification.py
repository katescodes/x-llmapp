#!/usr/bin/env python3
"""测试范本识别规则"""
import sys
sys.path.insert(0, '/app')

from app.works.tender.template_matcher import identify_potential_template

# 测试案例
test_cases = [
    {
        "name": "投标函格式范本",
        "text": """
        投标函格式
        
        致：_____________（采购人名称）
        
        我方已仔细研究________________（项目名称）招标文件的全部内容，愿意以人民币
        （大写）______________元的投标总报价，工期____天，按合同约定实施和完成承包工程。
        
        投标人名称：__________________
        法定代表人：__________________（签字或盖章）
        日期：____年____月____日
        """,
        "meta": {"title": "投标函格式"}
    },
    {
        "name": "授权委托书范本",
        "text": """
        法定代表人授权委托书
        
        本授权委托书声明：我____（姓名）系____（投标人名称）的法定代表人，现授权委托本公司的
        ____（姓名）为我公司代理人，以本公司的名义参加____（项目名称）的投标活动。
        
        代理人在开标、评标、合同谈判过程中所签署的一切文件和处理与之有关的一切事务，我均予以承认。
        
        投标人：____________（盖章）
        法定代表人：____________（签字）
        授权代表：____________（签字）
        """,
        "meta": {"title": "授权委托书"}
    },
    {
        "name": "普通招标须知（非范本）",
        "text": """
        一、磋商方须知
        
        1、适用范围
        本磋商文件仅适用于本次竞争性磋商采购所叙述的货物与服务。
        
        2、合格的磋商方
        磋商方须对以下情形作出书面承诺或证明：
        （1）具有独立承担民事责任的能力。
        （2）具有良好的商业信誉和健全的财务会计制度。
        （3）具有履行合同所必需的设备、专业技术能力。
        """,
        "meta": {"title": "磋商方须知"}
    },
    {
        "name": "评分标准（非范本）",
        "text": """
        评分标准
        
        一、技术评分（40分）
        1. 技术方案完整性（10分）
        2. 实施方案合理性（15分）
        3. 人员配置（15分）
        
        二、商务评分（30分）
        1. 资质证书（10分）
        2. 业绩（20分）
        """,
        "meta": {"title": "评分标准"}
    },
]

def main():
    print("=" * 60)
    print("🧪 范本识别规则测试")
    print("=" * 60)
    
    for i, case in enumerate(test_cases, 1):
        print(f"\n测试 {i}: {case['name']}")
        print("-" * 60)
        
        result = identify_potential_template(
            chunk_text=case["text"],
            chunk_meta=case["meta"]
        )
        
        if result:
            print(f"✅ 识别为范本")
            print(f"   分数: {result.get('template_score', 0)}")
            print(f"   特征: {', '.join(result.get('template_hints', []))}")
        else:
            print(f"❌ 未识别为范本")
        
        # 显示内容预览
        preview = case["text"].strip()[:100].replace('\n', ' ')
        print(f"   内容预览: {preview}...")
    
    print("\n" + "=" * 60)
    print("📊 识别规则说明")
    print("=" * 60)
    print("""
范本识别需要满足以下条件之一：

✅ 必须包含关键词:
   - 格式、范本、模板、样表、样式、参考格式
   - 标准格式、填写说明、附表、附件表

✅ 内容特征（加分项）:
   - 大量下划线 ____ （填写位置）
   - 空白框 [ ] 或 （ ）
   - 范本起始词："致："、"兹授权"、"本人"、"我单位"
   - 表格结构

❌ 排除关键词（即使有范本关键词也不算）:
   - 合同条款、评分标准、评分办法
   - 技术规范、验收标准、违约责任
    """)

if __name__ == "__main__":
    main()

