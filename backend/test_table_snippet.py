"""
æµ‹è¯•è¡¨æ ¼å‹èŒƒæœ¬çš„å†…å®¹æå–
ä¾‹å¦‚ï¼šæŠ¥ä»·ä¸€è§ˆè¡¨ã€å¼€æ ‡ä¸€è§ˆè¡¨ç­‰
"""
from app.works.tender.snippet.doc_blocks import blocks_to_text


def test_price_list_snippet():
    """æµ‹è¯•æŠ¥ä»·ä¸€è§ˆè¡¨çš„å†…å®¹æå–"""
    
    # æ¨¡æ‹Ÿ"è´§ç‰©æŠ¥ä»·ä¸€è§ˆè¡¨"èŒƒæœ¬
    price_list_blocks = [
        {
            "blockId": "b1",
            "type": "p",
            "text": "é™„ä»¶2ï¼šè´§ç‰©æŠ¥ä»·ä¸€è§ˆè¡¨"
        },
        {
            "blockId": "b2",
            "type": "p",
            "text": "é¡¹ç›®åç§°ï¼š_______________"
        },
        {
            "blockId": "b3",
            "type": "table",
            "rows": [
                ["åºå·", "è´§ç‰©åç§°", "è§„æ ¼å‹å·", "å•ä½", "æ•°é‡", "å•ä»·ï¼ˆå…ƒï¼‰", "æ€»ä»·ï¼ˆå…ƒï¼‰", "å¤‡æ³¨"],
                ["1", "", "", "", "", "", "", ""],
                ["2", "", "", "", "", "", "", ""],
                ["3", "", "", "", "", "", "", ""],
                ["4", "", "", "", "", "", "", ""],
                ["5", "", "", "", "", "", "", ""],
                ["", "", "", "", "åˆè®¡", "", "", ""]
            ]
        },
        {
            "blockId": "b4",
            "type": "p",
            "text": "æŠ•æ ‡æ€»ä»·ï¼ˆå¤§å†™ï¼‰ï¼š__________________å…ƒ"
        },
        {
            "blockId": "b5",
            "type": "p",
            "text": "æŠ•æ ‡äººï¼šï¼ˆç›–ç« ï¼‰________________"
        },
        {
            "blockId": "b6",
            "type": "p",
            "text": "æ—¥æœŸï¼š____å¹´____æœˆ____æ—¥"
        }
    ]
    
    content = blocks_to_text(price_list_blocks)
    
    print("=" * 80)
    print("æŠ¥ä»·ä¸€è§ˆè¡¨èŒƒæœ¬å†…å®¹æå–")
    print("=" * 80)
    print(content)
    print("=" * 80)
    print(f"æ–‡æœ¬é•¿åº¦: {len(content)} å­—ç¬¦")
    
    # éªŒè¯
    assert "è´§ç‰©æŠ¥ä»·ä¸€è§ˆè¡¨" in content
    assert "[è¡¨æ ¼å¼€å§‹]" in content
    assert "åºå·" in content
    assert "è´§ç‰©åç§°" in content
    assert "å•ä»·ï¼ˆå…ƒï¼‰" in content
    assert "åˆè®¡" in content
    assert "[è¡¨æ ¼ç»“æŸ]" in content
    print("\nâœ… æŠ¥ä»·ä¸€è§ˆè¡¨æå–æ­£å¸¸ï¼")


def test_bid_opening_form():
    """æµ‹è¯•å¼€æ ‡ä¸€è§ˆè¡¨çš„å†…å®¹æå–"""
    
    # æ¨¡æ‹Ÿ"å¼€æ ‡ä¸€è§ˆè¡¨"èŒƒæœ¬
    bid_opening_blocks = [
        {
            "blockId": "b1",
            "type": "p",
            "text": "é™„ä»¶1ï¼šå¼€æ ‡ä¸€è§ˆè¡¨"
        },
        {
            "blockId": "b2",
            "type": "p",
            "text": ""
        },
        {
            "blockId": "b3",
            "type": "table",
            "rows": [
                ["é¡¹ç›®åç§°", ""],
                ["æŠ•æ ‡äººåç§°", ""],
                ["æŠ•æ ‡æŠ¥ä»·ï¼ˆå…ƒï¼‰", "å¤§å†™ï¼š\nå°å†™ï¼š"],
                ["å·¥æœŸ", ""],
                ["è´¨é‡æ ‡å‡†", ""],
                ["é¡¹ç›®è´Ÿè´£äºº", ""],
                ["å¤‡æ³¨", ""]
            ]
        },
        {
            "blockId": "b4",
            "type": "p",
            "text": ""
        },
        {
            "blockId": "b5",
            "type": "p",
            "text": "æŠ•æ ‡äººï¼šï¼ˆç›–ç« ï¼‰________________"
        },
        {
            "blockId": "b6",
            "type": "p",
            "text": "æ³•å®šä»£è¡¨äººæˆ–å…¶å§”æ‰˜ä»£ç†äººï¼šï¼ˆç­¾å­—æˆ–ç›–ç« ï¼‰________________"
        },
        {
            "blockId": "b7",
            "type": "p",
            "text": "æ—¥æœŸï¼š____å¹´____æœˆ____æ—¥"
        }
    ]
    
    content = blocks_to_text(bid_opening_blocks)
    
    print("\n" + "=" * 80)
    print("å¼€æ ‡ä¸€è§ˆè¡¨èŒƒæœ¬å†…å®¹æå–")
    print("=" * 80)
    print(content)
    print("=" * 80)
    print(f"æ–‡æœ¬é•¿åº¦: {len(content)} å­—ç¬¦")
    
    # éªŒè¯
    assert "å¼€æ ‡ä¸€è§ˆè¡¨" in content
    assert "æŠ•æ ‡æŠ¥ä»·" in content
    assert "å·¥æœŸ" in content
    assert "è´¨é‡æ ‡å‡†" in content
    print("\nâœ… å¼€æ ‡ä¸€è§ˆè¡¨æå–æ­£å¸¸ï¼")


def test_complex_table_snippet():
    """æµ‹è¯•å¤æ‚è¡¨æ ¼èŒƒæœ¬ï¼ˆå¤šä¸ªè¡¨æ ¼ï¼‰"""
    
    # æ¨¡æ‹ŸåŒ…å«å¤šä¸ªè¡¨æ ¼çš„å¤æ‚èŒƒæœ¬
    complex_blocks = [
        {
            "blockId": "b1",
            "type": "p",
            "text": "é™„ä»¶3ï¼šå•†åŠ¡åç¦»è¡¨"
        },
        {
            "blockId": "b2",
            "type": "p",
            "text": "è¯´æ˜ï¼šæœ¬è¡¨ç”¨äºæŠ•æ ‡äººè¯´æ˜å…¶æŠ•æ ‡æ–‡ä»¶ä¸æ‹›æ ‡æ–‡ä»¶å•†åŠ¡æ¡æ¬¾çš„åç¦»æƒ…å†µã€‚"
        },
        {
            "blockId": "b3",
            "type": "table",
            "rows": [
                ["åºå·", "æ‹›æ ‡æ–‡ä»¶å•†åŠ¡æ¡æ¬¾", "æŠ•æ ‡æ–‡ä»¶å•†åŠ¡æ¡æ¬¾", "åç¦»è¯´æ˜", "å¤‡æ³¨"],
                ["1", "", "", "æ— åç¦»/æ­£åç¦»/è´Ÿåç¦»", ""],
                ["2", "", "", "æ— åç¦»/æ­£åç¦»/è´Ÿåç¦»", ""],
                ["3", "", "", "æ— åç¦»/æ­£åç¦»/è´Ÿåç¦»", ""]
            ]
        },
        {
            "blockId": "b4",
            "type": "p",
            "text": "æ³¨ï¼š1. å¦‚æ— åç¦»ï¼Œè¯·åœ¨åç¦»è¯´æ˜æ å¡«å†™\"æ— åç¦»\"ï¼›"
        },
        {
            "blockId": "b5",
            "type": "p",
            "text": "    2. å¦‚æœ‰åç¦»ï¼Œè¯·è¯¦ç»†è¯´æ˜åç¦»å†…å®¹åŠå½±å“ã€‚"
        },
        {
            "blockId": "b6",
            "type": "table",
            "rows": [
                ["æŠ•æ ‡äºº", ""],
                ["æ³•å®šä»£è¡¨äºº", ""],
                ["æ—¥æœŸ", ""]
            ]
        },
        {
            "blockId": "b7",
            "type": "p",
            "text": "æŠ•æ ‡äººï¼šï¼ˆç›–ç« ï¼‰"
        }
    ]
    
    content = blocks_to_text(complex_blocks)
    
    print("\n" + "=" * 80)
    print("å¤æ‚è¡¨æ ¼èŒƒæœ¬å†…å®¹æå–ï¼ˆåŒ…å«å¤šä¸ªè¡¨æ ¼ï¼‰")
    print("=" * 80)
    print(content)
    print("=" * 80)
    print(f"æ–‡æœ¬é•¿åº¦: {len(content)} å­—ç¬¦")
    
    # éªŒè¯å¤šä¸ªè¡¨æ ¼éƒ½è¢«æå–
    table_count = content.count("[è¡¨æ ¼å¼€å§‹]")
    print(f"\næå–çš„è¡¨æ ¼æ•°é‡: {table_count}")
    assert table_count == 2
    assert "å•†åŠ¡åç¦»è¡¨" in content
    assert "æ‹›æ ‡æ–‡ä»¶å•†åŠ¡æ¡æ¬¾" in content
    print("\nâœ… å¤æ‚è¡¨æ ¼èŒƒæœ¬æå–æ­£å¸¸ï¼")


if __name__ == "__main__":
    test_price_list_snippet()
    test_bid_opening_form()
    test_complex_table_snippet()
    
    print("\n" + "=" * 80)
    print("ğŸ‰ æ‰€æœ‰è¡¨æ ¼å‹èŒƒæœ¬æµ‹è¯•é€šè¿‡ï¼")
    print("=" * 80)
