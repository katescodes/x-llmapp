# äº¿æ—äº¿é—®ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è§ˆ](#é¡¹ç›®æ¦‚è§ˆ)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [åç«¯æ¶æ„](#åç«¯æ¶æ„)
- [å‰ç«¯æ¶æ„](#å‰ç«¯æ¶æ„)
- [æ•°æ®å­˜å‚¨](#æ•°æ®å­˜å‚¨)
- [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)

---

## é¡¹ç›®æ¦‚è§ˆ

**äº¿æ—äº¿é—® (LocalGPT Search)** æ˜¯ä¸€ä¸ªé¢å‘æœ¬åœ°éƒ¨ç½²çš„ LLM + Hybrid RAG é¡¹ç›®ï¼Œå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›ï¼š

- å¤š LLM æ¨¡å‹åˆ‡æ¢ä¸ç®¡ç†
- Google Programmable Search è”ç½‘æœç´¢
- Postgres è¯æ³•æ£€ç´¢ + Milvus å‘é‡æ£€ç´¢çš„æ··åˆ RAG
- çŸ¥è¯†åº“ç®¡ç†ï¼ˆæ”¯æŒå¤šç§æ–‡æ¡£æ ¼å¼ï¼‰
- å®æ—¶è¯­éŸ³è½¬å†™ï¼ˆASRï¼‰
- æ‹›æŠ•æ ‡æ–‡æ¡£æ™ºèƒ½å¤„ç†
- æ–‡æ¡£é™„ä»¶ä¸Šä¼ ä¸æ™ºèƒ½åˆ†æ

**ç‰ˆæœ¬**: 0.2.0

---

## æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| FastAPI | 0.115.0 | Web æ¡†æ¶ |
| Uvicorn | 0.30.5 | ASGI æœåŠ¡å™¨ |
| Pydantic | 2.8.2 | æ•°æ®éªŒè¯ä¸åºåˆ—åŒ– |
| SQLAlchemy | 2.0.32+ | ORM æ¡†æ¶ |
| Psycopg | 3.1.18 | PostgreSQL é©±åŠ¨ |
| Milvus Lite | 2.4.6 | å‘é‡æ•°æ®åº“ |
| PyMilvus | 2.4.6 | Milvus å®¢æˆ·ç«¯ |
| BeautifulSoup4 | 4.12.3 | HTML è§£æ |
| Trafilatura | 1.6.3 | ç½‘é¡µå†…å®¹æå– |
| PyPDF | 4.0.2 | PDF å¤„ç† |
| PyMuPDF | 1.24.10 | é«˜çº§ PDF å¤„ç† |
| python-docx | 1.1.2 | Word æ–‡æ¡£å¤„ç† |
| python-pptx | 0.6.23 | PPT æ–‡æ¡£å¤„ç† |
| PyJWT | 2.8.0+ | JWT è®¤è¯ |
| httpx | 0.27.0 | HTTP å®¢æˆ·ç«¯ |
| tiktoken | 0.7.0 | Token è®¡æ•° |
| librosa | 0.10.0+ | éŸ³é¢‘å¤„ç† |
| noisereduce | 3.0.0+ | éŸ³é¢‘é™å™ª |
| rapidfuzz | 3.9.7 | æ¨¡ç³ŠåŒ¹é… |

### å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| React | 18.3.1 | UI æ¡†æ¶ |
| TypeScript | 5.5.4 | ç±»å‹ç³»ç»Ÿ |
| Vite | 5.4.0 | æ„å»ºå·¥å…· |
| react-markdown | 10.1.0 | Markdown æ¸²æŸ“ |
| remark-gfm | 4.0.0 | GitHub Flavored Markdown |

### åŸºç¡€è®¾æ–½

| ç»„ä»¶ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| PostgreSQL | 15-alpine | å…³ç³»æ•°æ®åº“ |
| Docker | - | å®¹å™¨åŒ– |
| Docker Compose | - | å®¹å™¨ç¼–æ’ |
| Nginx | - | å‰ç«¯é™æ€æœåŠ¡ |

---

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·æµè§ˆå™¨                              â”‚
â”‚                     http://localhost:6173                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯æœåŠ¡ (React + Vite)                      â”‚
â”‚                      Port: 6173 (Nginx)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ChatLayout â”‚ KB Manager   â”‚ TenderWorkspaceâ”‚ SystemSettingsâ”‚  â”‚
â”‚  â”‚            â”‚              â”‚                â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ HTTP/WebSocket
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åç«¯æœåŠ¡ (FastAPI + Uvicorn)                   â”‚
â”‚                     Port: 9001 (å†…éƒ¨:8000)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     API Routers                          â”‚   â”‚
â”‚  â”‚  /api/chat  /api/kb  /api/tender  /api/auth  /api/asr   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Business Services                      â”‚   â”‚
â”‚  â”‚  LLM Orchestrator â”‚ RAG Service â”‚ Tender Service        â”‚   â”‚
â”‚  â”‚  KB Service â”‚ ASR Service â”‚ Template Service            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Data Access Layer                     â”‚   â”‚
â”‚  â”‚  DAO (Chat/KB/Tender) â”‚ Postgres Client â”‚ Milvus Client â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                        â”‚
           â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL          â”‚  â”‚  Milvus Lite         â”‚
â”‚  Port: 5432          â”‚  â”‚  (SQLite-based)      â”‚
â”‚  - Users             â”‚  â”‚  - Vector Index      â”‚
â”‚  - Chat Sessions     â”‚  â”‚  - HNSW Algorithm    â”‚
â”‚  - KB Documents      â”‚  â”‚                      â”‚
â”‚  - KB Chunks         â”‚  â”‚                      â”‚
â”‚  - Tender Projects   â”‚  â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

External Services:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Google CSE API      â”‚  â”‚  Remote LLM APIs     â”‚
â”‚  - Web Search        â”‚  â”‚  - OpenAI / Ollama   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - Custom Models     â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Remote ASR API      â”‚
â”‚  - Whisper Service   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åç«¯æ¶æ„

### ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py                      # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py                    # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ dependencies.py              # ä¾èµ–æ³¨å…¥
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                      # æ•°æ®æ¨¡å‹ (ORM)
â”‚   â”‚   â”œâ”€â”€ base.py                  # SQLAlchemy åŸºç¡€æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ user.py                  # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ chat.py                  # èŠå¤©ä¼šè¯/æ¶ˆæ¯æ¨¡å‹
â”‚   â”‚   â””â”€â”€ attachment.py            # é™„ä»¶æ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                     # Pydantic æ¨¡å‹ (API)
â”‚   â”‚   â”œâ”€â”€ chat.py                  # èŠå¤©ç›¸å…³ Schema
â”‚   â”‚   â”œâ”€â”€ kb.py                    # çŸ¥è¯†åº“ Schema
â”‚   â”‚   â”œâ”€â”€ kb_category.py           # çŸ¥è¯†åº“åˆ†ç±» Schema
â”‚   â”‚   â”œâ”€â”€ tender.py                # æ‹›æŠ•æ ‡ Schema
â”‚   â”‚   â”œâ”€â”€ template/                # æ¨¡æ¿ç›¸å…³ Schema
â”‚   â”‚   â”œâ”€â”€ template_extract.py      # æ¨¡æ¿æå– Schema
â”‚   â”‚   â”œâ”€â”€ semantic_outline.py      # è¯­ä¹‰å¤§çº² Schema
â”‚   â”‚   â”œâ”€â”€ llm_config.py            # LLM é…ç½® Schema
â”‚   â”‚   â”œâ”€â”€ embedding_config.py      # Embedding é…ç½® Schema
â”‚   â”‚   â”œâ”€â”€ embedding_provider.py    # Embedding æä¾›å•† Schema
â”‚   â”‚   â”œâ”€â”€ app_settings.py          # åº”ç”¨è®¾ç½® Schema
â”‚   â”‚   â”œâ”€â”€ attachment.py            # é™„ä»¶ Schema
â”‚   â”‚   â”œâ”€â”€ search.py                # æœç´¢ Schema
â”‚   â”‚   â”œâ”€â”€ intent.py                # æ„å›¾è¯†åˆ« Schema
â”‚   â”‚   â”œâ”€â”€ orchestrator.py          # ç¼–æ’å™¨ Schema
â”‚   â”‚   â”œâ”€â”€ project_delete.py        # é¡¹ç›®åˆ é™¤ Schema
â”‚   â”‚   â”œâ”€â”€ case.py                  # æ¡ˆä¾‹ Schema
â”‚   â”‚   â””â”€â”€ types.py                 # é€šç”¨ç±»å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ routers/                     # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth.py                  # è®¤è¯æ¥å£
â”‚   â”‚   â”œâ”€â”€ chat.py                  # èŠå¤©æ¥å£
â”‚   â”‚   â”œâ”€â”€ history.py               # å†å²è®°å½•æ¥å£
â”‚   â”‚   â”œâ”€â”€ kb.py                    # çŸ¥è¯†åº“æ¥å£
â”‚   â”‚   â”œâ”€â”€ kb_category.py           # çŸ¥è¯†åº“åˆ†ç±»æ¥å£
â”‚   â”‚   â”œâ”€â”€ llm.py                   # LLM ç®¡ç†æ¥å£
â”‚   â”‚   â”œâ”€â”€ llm_config.py            # LLM é…ç½®æ¥å£
â”‚   â”‚   â”œâ”€â”€ embedding_providers.py   # Embedding æä¾›å•†æ¥å£
â”‚   â”‚   â”œâ”€â”€ app_settings.py          # åº”ç”¨è®¾ç½®æ¥å£
â”‚   â”‚   â”œâ”€â”€ attachments.py           # é™„ä»¶æ¥å£
â”‚   â”‚   â”œâ”€â”€ asr_ws.py                # å®æ—¶ ASR WebSocket æ¥å£
â”‚   â”‚   â”œâ”€â”€ asr_configs.py           # ASR é…ç½®æ¥å£
â”‚   â”‚   â”œâ”€â”€ recordings.py            # å½•éŸ³ç®¡ç†æ¥å£
â”‚   â”‚   â”œâ”€â”€ tender.py                # æ‹›æŠ•æ ‡æ¥å£
â”‚   â”‚   â”œâ”€â”€ tender_snippets.py       # æ‹›æŠ•æ ‡ç‰‡æ®µæ¥å£
â”‚   â”‚   â”œâ”€â”€ template_analysis.py     # æ¨¡æ¿åˆ†ææ¥å£
â”‚   â”‚   â”œâ”€â”€ export.py                # å¯¼å‡ºæ¥å£
â”‚   â”‚   â””â”€â”€ health.py                # å¥åº·æ£€æŸ¥æ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                    # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ db/                      # æ•°æ®åº“å±‚
â”‚   â”‚   â”‚   â””â”€â”€ postgres.py          # PostgreSQL è¿æ¥ç®¡ç†
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ dao/                     # æ•°æ®è®¿é—®å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ chat_dao.py          # èŠå¤©æ•°æ®è®¿é—®
â”‚   â”‚   â”‚   â”œâ”€â”€ kb_dao.py            # çŸ¥è¯†åº“æ•°æ®è®¿é—®
â”‚   â”‚   â”‚   â”œâ”€â”€ kb_category_dao.py   # çŸ¥è¯†åº“åˆ†ç±»æ•°æ®è®¿é—®
â”‚   â”‚   â”‚   â””â”€â”€ tender_dao.py        # æ‹›æŠ•æ ‡æ•°æ®è®¿é—®
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ llm_orchestrator.py      # LLM ç¼–æ’å™¨ (ä¸»æ§)
â”‚   â”‚   â”œâ”€â”€ llm_client.py            # LLM å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ llm_helpers.py           # LLM è¾…åŠ©å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ llm_model_store.py       # LLM æ¨¡å‹å­˜å‚¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ intent/                  # æ„å›¾è¯†åˆ«
â”‚   â”‚   â”‚   â””â”€â”€ intent_parser.py     # æ„å›¾è§£æå™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ embedding/               # Embedding æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ http_embedding_client.py  # HTTP Embedding å®¢æˆ·ç«¯
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ embedding_provider_store.py  # Embedding æä¾›å•†å­˜å‚¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ vectorstore/             # å‘é‡å­˜å‚¨
â”‚   â”‚   â”‚   â””â”€â”€ milvus_lite_store.py # Milvus Lite å®ç°
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ retrieval/               # æ£€ç´¢æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ retriever.py         # ä¸»æ£€ç´¢å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ pg_lexical.py        # PostgreSQL è¯æ³•æ£€ç´¢
â”‚   â”‚   â”‚   â””â”€â”€ rrf.py               # RRF (Reciprocal Rank Fusion)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ rag_service.py           # RAG æœåŠ¡ä¸»æ§
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ google_cse.py            # Google Custom Search
â”‚   â”‚   â”œâ”€â”€ google_search.py         # Google æœç´¢æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ search_client.py         # æœç´¢å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ search_usage.py          # æœç´¢é…é¢ç®¡ç†
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ crawler/                 # ç½‘é¡µçˆ¬è™«
â”‚   â”‚   â”‚   â”œâ”€â”€ fetcher.py           # ç½‘é¡µæŠ“å–
â”‚   â”‚   â”‚   â””â”€â”€ extractor.py         # å†…å®¹æå–
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ webpage_fetcher.py       # ç½‘é¡µè·å–å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ segmenter/               # æ–‡æœ¬åˆ†å—
â”‚   â”‚   â”‚   â””â”€â”€ chunker.py           # æ–‡æœ¬åˆ†å—å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ documents/               # æ–‡æ¡£è§£æ
â”‚   â”‚   â”‚   â””â”€â”€ parser.py            # å¤šæ ¼å¼æ–‡æ¡£è§£æå™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ cache/                   # ç¼“å­˜å±‚
â”‚   â”‚   â”‚   â””â”€â”€ doc_cache.py         # æ–‡æ¡£ç¼“å­˜
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ kb_service.py            # çŸ¥è¯†åº“æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ history_store.py         # å†å²è®°å½•å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ history_decision.py      # å†å²è®°å½•å†³ç­–
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ attachment_store.py      # é™„ä»¶å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ attachment_context.py    # é™„ä»¶ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ asr_service.py           # ASR æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ asr_api_service.py       # ASR API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ asr_config_service.py    # ASR é…ç½®æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ recording_service.py     # å½•éŸ³æœåŠ¡
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ tender/                  # æ‹›æŠ•æ ‡æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ doc_blocks.py        # æ–‡æ¡£å—å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ snippet_extract.py   # ç‰‡æ®µæå–
â”‚   â”‚   â”‚   â”œâ”€â”€ snippet_llm.py       # ç‰‡æ®µ LLM å¤„ç†
â”‚   â”‚   â”‚   â””â”€â”€ snippet_locator.py   # ç‰‡æ®µå®šä½
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ tender_service.py        # æ‹›æŠ•æ ‡æœåŠ¡ä¸»æ§
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ template/                # æ¨¡æ¿æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ docx_blocks.py       # DOCX å—å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ docx_extractor.py    # DOCX æå–å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ docx_ooxml.py        # DOCX OOXML å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ docx_structure.py    # DOCX ç»“æ„åˆ†æ
â”‚   â”‚   â”‚   â”œâ”€â”€ llm_analyzer.py      # LLM åˆ†æå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ outline_fallback.py  # å¤§çº²å›é€€ç­–ç•¥
â”‚   â”‚   â”‚   â”œâ”€â”€ outline_merger.py    # å¤§çº²åˆå¹¶
â”‚   â”‚   â”‚   â”œâ”€â”€ spec_validator.py    # è§„èŒƒéªŒè¯å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ style_hints_fallback.py  # æ ·å¼æç¤ºå›é€€
â”‚   â”‚   â”‚   â”œâ”€â”€ template_analyzer.py     # æ¨¡æ¿åˆ†æå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ template_applyassets_llm.py  # æ¨¡æ¿èµ„äº§åº”ç”¨
â”‚   â”‚   â”‚   â”œâ”€â”€ template_parse_preview.py    # æ¨¡æ¿è§£æé¢„è§ˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ template_renderer.py         # æ¨¡æ¿æ¸²æŸ“å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ template_spec.py             # æ¨¡æ¿è§„èŒƒ
â”‚   â”‚   â”‚   â””â”€â”€ template_style_analyzer.py   # æ¨¡æ¿æ ·å¼åˆ†æ
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ template_extract/        # æ¨¡æ¿æå–æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ orchestrator_service.py      # ç¼–æ’å™¨æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ candidate_recall_service.py  # å€™é€‰å¬å›æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ coverage_guard_service.py    # è¦†ç›–ä¿æŠ¤æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ llm_span_service.py          # LLM è·¨åº¦æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ span_refiner_service.py      # è·¨åº¦ç²¾ç‚¼æœåŠ¡
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ fragment/                # ç‰‡æ®µå¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ fragment_extractor.py    # ç‰‡æ®µæå–å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ fragment_matcher.py      # ç‰‡æ®µåŒ¹é…å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ fragment_preview.py      # ç‰‡æ®µé¢„è§ˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ fragment_type.py         # ç‰‡æ®µç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ fragment_dict_zh_CN.json # ç‰‡æ®µå­—å…¸
â”‚   â”‚   â”‚   â”œâ”€â”€ builtin_samples.py       # å†…ç½®æ ·æœ¬
â”‚   â”‚   â”‚   â”œâ”€â”€ docx_body_indexer.py     # DOCX ä¸»ä½“ç´¢å¼•
â”‚   â”‚   â”‚   â”œâ”€â”€ llm_span_locator.py      # LLM è·¨åº¦å®šä½
â”‚   â”‚   â”‚   â”œâ”€â”€ outline_attacher.py      # å¤§çº²é™„åŠ å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ pdf_blocks.py            # PDF å—å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ pdf_convert.py           # PDF è½¬æ¢
â”‚   â”‚   â”‚   â”œâ”€â”€ pdf_layout_extractor.py  # PDF å¸ƒå±€æå–
â”‚   â”‚   â”‚   â””â”€â”€ pdf_sample_detector.py   # PDF æ ·æœ¬æ£€æµ‹
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ semantic_outline/        # è¯­ä¹‰å¤§çº²
â”‚   â”‚   â”‚   â”œâ”€â”€ outline_synthesis_service.py     # å¤§çº²åˆæˆæœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ requirement_extraction_service.py # éœ€æ±‚æå–æœåŠ¡
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ export/                  # å¯¼å‡ºæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ export_service.py    # å¯¼å‡ºæœåŠ¡ä¸»æ§
â”‚   â”‚   â”‚   â”œâ”€â”€ docx_exporter.py     # DOCX å¯¼å‡ºå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ docx_copier.py       # DOCX å¤åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ docx_template_loader.py  # DOCX æ¨¡æ¿åŠ è½½å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ html_to_docx.py      # HTML è½¬ DOCX
â”‚   â”‚   â”‚   â”œâ”€â”€ style_applier.py     # æ ·å¼åº”ç”¨å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ style_map.py         # æ ·å¼æ˜ å°„
â”‚   â”‚   â”‚   â”œâ”€â”€ summary_backfill.py  # æ‘˜è¦å›å¡«
â”‚   â”‚   â”‚   â””â”€â”€ tree_builder.py      # æ ‘æ„å»ºå™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ orchestrator/            # ç¼–æ’å™¨æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ orchestrator_service.py  # ç¼–æ’å™¨ä¸»æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ prompts.py               # æç¤ºè¯æ¨¡æ¿
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ project_delete/          # é¡¹ç›®åˆ é™¤
â”‚   â”‚   â”‚   â”œâ”€â”€ orchestrator.py      # åˆ é™¤ç¼–æ’å™¨
â”‚   â”‚   â”‚   â””â”€â”€ cleaners.py          # æ¸…ç†å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ office/                  # Office æ–‡ä»¶å¤„ç†
â”‚   â”‚   â”‚   â””â”€â”€ convert.py           # æ ¼å¼è½¬æ¢
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ logging/                 # æ—¥å¿—æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ request_logger.py    # è¯·æ±‚æ—¥å¿—è®°å½•
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ settings_store.py        # è®¾ç½®å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ user_service.py          # ç”¨æˆ·æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ prompt_templates.py      # æç¤ºè¯æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ docx_style_utils.py      # DOCX æ ·å¼å·¥å…·
â”‚   â”‚   â””â”€â”€ case_utils.py            # æ¡ˆä¾‹å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                       # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ auth.py                  # è®¤è¯å·¥å…·
â”‚   â”‚   â”œâ”€â”€ llm_endpoints.py         # LLM ç«¯ç‚¹å·¥å…·
â”‚   â”‚   â”œâ”€â”€ text_extractor.py        # æ–‡æœ¬æå–å·¥å…·
â”‚   â”‚   â””â”€â”€ text_utils.py            # æ–‡æœ¬å¤„ç†å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                      # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ template_extract_config.py  # æ¨¡æ¿æå–é…ç½®
â”‚   â”‚
â”‚   â””â”€â”€ config_defaults/             # é»˜è®¤é…ç½®
â”‚       â”œâ”€â”€ app_settings.json        # é»˜è®¤åº”ç”¨è®¾ç½®
â”‚       â””â”€â”€ llm_models.json          # é»˜è®¤ LLM æ¨¡å‹é…ç½®
â”‚
â”œâ”€â”€ data/                            # è¿è¡Œæ—¶æ•°æ®ç›®å½•
â”œâ”€â”€ migrations/                      # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ scripts/                         # è¾…åŠ©è„šæœ¬
â”œâ”€â”€ tests/                           # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ requirements.txt                 # Python ä¾èµ–
â”œâ”€â”€ requirements-cpu.txt             # CPU ç‰ˆæœ¬ä¾èµ–
â””â”€â”€ Dockerfile                       # Docker æ„å»ºæ–‡ä»¶
```

### æ ¸å¿ƒæœåŠ¡æ¨¡å—è¯´æ˜

#### 1. LLM ç¼–æ’å±‚

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| LLM ç¼–æ’å™¨ | `llm_orchestrator.py` | ç»Ÿä¸€çš„ LLM è°ƒç”¨æ¥å£ï¼Œæ”¯æŒå¤šæ¨¡å‹åˆ‡æ¢ |
| LLM å®¢æˆ·ç«¯ | `llm_client.py` | åº•å±‚ LLM API è°ƒç”¨ |
| LLM æ¨¡å‹å­˜å‚¨ | `llm_model_store.py` | LLM æ¨¡å‹é…ç½®çš„æŒä¹…åŒ–ç®¡ç† |

#### 2. RAG æ£€ç´¢å±‚

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| RAG æœåŠ¡ | `rag_service.py` | RAG æœåŠ¡ä¸»æ§ï¼Œåè°ƒæ£€ç´¢å’Œç”Ÿæˆ |
| æ£€ç´¢å™¨ | `retrieval/retriever.py` | ç»Ÿä¸€æ£€ç´¢æ¥å£ |
| è¯æ³•æ£€ç´¢ | `retrieval/pg_lexical.py` | PostgreSQL å…¨æ–‡æ£€ç´¢ (tsvector + pg_trgm) |
| å‘é‡æ£€ç´¢ | `vectorstore/milvus_lite_store.py` | Milvus Lite å‘é‡æ£€ç´¢ (HNSW) |
| RRF èåˆ | `retrieval/rrf.py` | è¯æ³•å’Œå‘é‡æ£€ç´¢ç»“æœèåˆ |
| æ„å›¾è§£æ | `intent/intent_parser.py` | ç”¨æˆ·æ„å›¾è¯†åˆ«ä¸æŸ¥è¯¢é‡å†™ |

#### 3. çŸ¥è¯†åº“æœåŠ¡

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| çŸ¥è¯†åº“æœåŠ¡ | `kb_service.py` | çŸ¥è¯†åº“ CRUD æ“ä½œ |
| çŸ¥è¯†åº“ DAO | `dao/kb_dao.py` | çŸ¥è¯†åº“æ•°æ®è®¿é—® |
| æ–‡æ¡£è§£æå™¨ | `documents/parser.py` | å¤šæ ¼å¼æ–‡æ¡£è§£æ (TXT/MD/PDF/DOCX/PPTX) |
| æ–‡æœ¬åˆ†å—å™¨ | `segmenter/chunker.py` | æ–‡æ¡£åˆ†å—ç­–ç•¥ |
| æ–‡æ¡£ç¼“å­˜ | `cache/doc_cache.py` | æ–‡æ¡£å»é‡ç¼“å­˜ |

#### 4. æœç´¢æœåŠ¡

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| Google CSE | `google_cse.py` | Google è‡ªå®šä¹‰æœç´¢ API |
| æœç´¢é…é¢ | `search_usage.py` | æœç´¢é…é¢ç®¡ç†ä¸é™æµ |
| ç½‘é¡µçˆ¬è™« | `crawler/fetcher.py` | ç½‘é¡µå†…å®¹æŠ“å– |
| å†…å®¹æå– | `crawler/extractor.py` | ç½‘é¡µæ­£æ–‡æå– (trafilatura + BS4) |

#### 5. æ‹›æŠ•æ ‡æœåŠ¡

| æ¨¡å— | ç›®å½•/æ–‡ä»¶ | åŠŸèƒ½ |
|------|----------|------|
| æ‹›æŠ•æ ‡æœåŠ¡ | `tender_service.py` | æ‹›æŠ•æ ‡ä¸šåŠ¡ä¸»æ§ |
| æ‹›æŠ•æ ‡ DAO | `dao/tender_dao.py` | æ‹›æŠ•æ ‡æ•°æ®è®¿é—® |
| ç‰‡æ®µæå– | `tender/snippet_extract.py` | æ‹›æŠ•æ ‡æ–‡æ¡£ç‰‡æ®µæå– |
| ç‰‡æ®µå®šä½ | `tender/snippet_locator.py` | ç‰‡æ®µä½ç½®å®šä½ |
| LLM å¤„ç† | `tender/snippet_llm.py` | ç‰‡æ®µ LLM åˆ†æ |

#### 6. æ¨¡æ¿æœåŠ¡

| æ¨¡å— | ç›®å½•/æ–‡ä»¶ | åŠŸèƒ½ |
|------|----------|------|
| æ¨¡æ¿åˆ†æ | `template/template_analyzer.py` | æ¨¡æ¿ç»“æ„åˆ†æ |
| æ¨¡æ¿æ¸²æŸ“ | `template/template_renderer.py` | æ¨¡æ¿æ¸²æŸ“å¼•æ“ |
| æ ·å¼åˆ†æ | `template/template_style_analyzer.py` | æ–‡æ¡£æ ·å¼åˆ†æ |
| LLM åˆ†æ | `template/llm_analyzer.py` | åŸºäº LLM çš„æ¨¡æ¿åˆ†æ |
| æ¨¡æ¿æå– | `template_extract/*` | æ¨¡æ¿æå–æµæ°´çº¿ |

#### 7. ç‰‡æ®µå¤„ç†æœåŠ¡

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| ç‰‡æ®µæå– | `fragment/fragment_extractor.py` | æ‹›æ ‡æ–‡æ¡£æ ¼å¼èŒƒæœ¬æå– |
| ç‰‡æ®µåŒ¹é… | `fragment/fragment_matcher.py` | ç‰‡æ®µæ¨¡å¼åŒ¹é… |
| PDF æå– | `fragment/pdf_layout_extractor.py` | PDF å¸ƒå±€åˆ†æä¸æå– |
| LLM å®šä½ | `fragment/llm_span_locator.py` | åŸºäº LLM çš„è·¨åº¦å®šä½ |

#### 8. ASR æœåŠ¡

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| ASR æœåŠ¡ | `asr_service.py` | è¯­éŸ³è¯†åˆ«æœåŠ¡ä¸»æ§ |
| ASR API | `asr_api_service.py` | è¿œç¨‹ ASR API è°ƒç”¨ |
| å½•éŸ³æœåŠ¡ | `recording_service.py` | å½•éŸ³æ–‡ä»¶ç®¡ç† |
| WebSocket | `routers/asr_ws.py` | å®æ—¶è¯­éŸ³è½¬å†™ WebSocket |

#### 9. å¯¼å‡ºæœåŠ¡

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| å¯¼å‡ºæœåŠ¡ | `export/export_service.py` | æ–‡æ¡£å¯¼å‡ºä¸»æ§ |
| DOCX å¯¼å‡º | `export/docx_exporter.py` | Word æ–‡æ¡£å¯¼å‡º |
| HTML è½¬æ¢ | `export/html_to_docx.py` | HTML è½¬ Word |
| æ ·å¼åº”ç”¨ | `export/style_applier.py` | æ ·å¼åº”ç”¨å™¨ |

---

## å‰ç«¯æ¶æ„

### ç›®å½•ç»“æ„

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx                     # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ App.tsx                      # æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ vite-env.d.ts                # Vite ç±»å‹å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ components/                  # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ChatLayout.tsx           # èŠå¤©å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ MessageList.tsx          # æ¶ˆæ¯åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ MessageBubble.tsx        # æ¶ˆæ¯æ°”æ³¡
â”‚   â”‚   â”œâ”€â”€ MessageInput.tsx         # æ¶ˆæ¯è¾“å…¥æ¡†
â”‚   â”‚   â”œâ”€â”€ ModularAnswer.tsx        # æ¨¡å—åŒ–å›ç­”æ˜¾ç¤º
â”‚   â”‚   â”œâ”€â”€ SourcePanel.tsx          # æ¥æºé¢æ¿
â”‚   â”‚   â”œâ”€â”€ VoiceRecorder.tsx        # è¯­éŸ³å½•åˆ¶å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ KnowledgeBaseManager.tsx # çŸ¥è¯†åº“ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ CategoryManager.tsx      # åˆ†ç±»ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ImportWizard.tsx         # å¯¼å…¥å‘å¯¼
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ SystemSettings.tsx       # ç³»ç»Ÿè®¾ç½®
â”‚   â”‚   â”œâ”€â”€ HeaderBar.tsx            # é¡¶éƒ¨å¯¼èˆªæ 
â”‚   â”‚   â”œâ”€â”€ LoginPage.tsx            # ç™»å½•é¡µé¢
â”‚   â”‚   â”œâ”€â”€ RecordingsList.tsx       # å½•éŸ³åˆ—è¡¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ TenderWorkspace.tsx      # æ‹›æŠ•æ ‡å·¥ä½œå°
â”‚   â”‚   â”œâ”€â”€ FormatTemplatesPage.tsx  # æ ¼å¼æ¨¡æ¿é¡µé¢
â”‚   â”‚   â”œâ”€â”€ TemplateManagement.tsx   # æ¨¡æ¿ç®¡ç†
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ tender/                  # æ‹›æŠ•æ ‡ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ DirectoryTree.tsx    # ç›®å½•æ ‘
â”‚   â”‚   â”‚   â”œâ”€â”€ DirectoryToolbar.tsx # ç›®å½•å·¥å…·æ 
â”‚   â”‚   â”‚   â”œâ”€â”€ DocumentCanvas.tsx   # æ–‡æ¡£ç”»å¸ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectInfoView.tsx  # é¡¹ç›®ä¿¡æ¯è§†å›¾
â”‚   â”‚   â”‚   â”œâ”€â”€ ReviewTable.tsx      # å®¡æŸ¥è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ RiskList.tsx         # é£é™©åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ RiskDetail.tsx       # é£é™©è¯¦æƒ…
â”‚   â”‚   â”‚   â”œâ”€â”€ RiskToolbar.tsx      # é£é™©å·¥å…·æ 
â”‚   â”‚   â”‚   â”œâ”€â”€ SampleSidebar.tsx    # æ ·æœ¬ä¾§è¾¹æ 
â”‚   â”‚   â”‚   â””â”€â”€ TemplateExtractPanel.tsx  # æ¨¡æ¿æå–é¢æ¿
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ template/                # æ¨¡æ¿ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ RichTocPreview.tsx   # å¯Œæ–‡æœ¬ç›®å½•é¢„è§ˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ templateApi.ts       # æ¨¡æ¿ API
â”‚   â”‚   â”‚   â””â”€â”€ templatePreviewUtils.ts  # æ¨¡æ¿é¢„è§ˆå·¥å…·
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ step3/                   # Step3 ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ RichTocBox.tsx       # å¯Œæ–‡æœ¬ç›®å½•æ¡†
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ editor/                  # ç¼–è¾‘å™¨ç»„ä»¶
â”‚   â”‚       â””â”€â”€ SimpleHtmlEditor.tsx # ç®€å• HTML ç¼–è¾‘å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ contexts/                    # React Context
â”‚   â”‚   â””â”€â”€ AuthContext.tsx          # è®¤è¯ä¸Šä¸‹æ–‡
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                       # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â””â”€â”€ usePermission.ts         # æƒé™ Hook
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                       # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ index.ts                 # ä¸»ç±»å‹å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ auth.ts                  # è®¤è¯ç±»å‹
â”‚   â”‚   â”œâ”€â”€ tender.ts                # æ‹›æŠ•æ ‡ç±»å‹
â”‚   â”‚   â”œâ”€â”€ orchestrator.ts          # ç¼–æ’å™¨ç±»å‹
â”‚   â”‚   â””â”€â”€ recording.ts             # å½•éŸ³ç±»å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                      # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ styles/                      # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ styles.css                   # å…¨å±€æ ·å¼
â”‚
â”œâ”€â”€ public/                          # é™æ€èµ„æº
â”œâ”€â”€ index.html                       # HTML æ¨¡æ¿
â”œâ”€â”€ package.json                     # npm é…ç½®
â”œâ”€â”€ tsconfig.json                    # TypeScript é…ç½®
â”œâ”€â”€ vite.config.ts                   # Vite é…ç½®
â”œâ”€â”€ nginx.conf                       # Nginx é…ç½®
â””â”€â”€ Dockerfile                       # Docker æ„å»ºæ–‡ä»¶
```

### é¡µé¢è·¯ç”±

| è·¯ç”± | ç»„ä»¶ | åŠŸèƒ½ |
|------|------|------|
| `/` (chat) | `ChatLayout` | èŠå¤©å¯¹è¯ç•Œé¢ |
| `/kb` | `KnowledgeBaseManager` | çŸ¥è¯†åº“ç®¡ç† |
| `/tender` | `TenderWorkspace` | æ‹›æŠ•æ ‡å·¥ä½œå° |
| `/format-templates` | `FormatTemplatesPage` | æ ¼å¼æ¨¡æ¿ç®¡ç† |
| `/settings` | `SystemSettings` | ç³»ç»Ÿè®¾ç½® |
| `/recordings` | `RecordingsList` | å½•éŸ³åˆ—è¡¨ |
| `/login` | `LoginPage` | ç™»å½•é¡µé¢ |

### æ ¸å¿ƒç»„ä»¶è¯´æ˜

#### 1. èŠå¤©æ¨¡å—

- **ChatLayout**: èŠå¤©é¡µé¢ä¸»å¸ƒå±€ï¼ŒåŒ…å«ä¾§è¾¹æ ã€æ¶ˆæ¯åˆ—è¡¨å’Œè¾“å…¥åŒº
- **MessageList**: æ¶ˆæ¯åˆ—è¡¨æ¸²æŸ“ï¼Œæ”¯æŒæ»šåŠ¨å’Œå¼•ç”¨è·³è½¬
- **MessageBubble**: å•ä¸ªæ¶ˆæ¯æ°”æ³¡ï¼Œæ”¯æŒ Markdown æ¸²æŸ“
- **MessageInput**: æ¶ˆæ¯è¾“å…¥æ¡†ï¼Œæ”¯æŒæ–‡ä»¶ä¸Šä¼ å’Œè¯­éŸ³è¾“å…¥
- **ModularAnswer**: æ¨¡å—åŒ–å›ç­”æ˜¾ç¤ºï¼Œæ”¯æŒç»“æ„åŒ–å†…å®¹
- **SourcePanel**: å¼•ç”¨æ¥æºé¢æ¿ï¼Œæ˜¾ç¤ºæ£€ç´¢åˆ°çš„å‚è€ƒæ–‡æ¡£
- **VoiceRecorder**: è¯­éŸ³å½•åˆ¶ç»„ä»¶ï¼Œæ”¯æŒå®æ—¶è½¬å†™

#### 2. çŸ¥è¯†åº“æ¨¡å—

- **KnowledgeBaseManager**: çŸ¥è¯†åº“ç®¡ç†ä¸»ç•Œé¢
- **CategoryManager**: çŸ¥è¯†åº“åˆ†ç±»ç®¡ç†
- **ImportWizard**: çŸ¥è¯†åº“å¯¼å…¥å‘å¯¼ï¼Œæ”¯æŒå¤šæ ¼å¼æ–‡æ¡£

#### 3. æ‹›æŠ•æ ‡æ¨¡å—

- **TenderWorkspace**: æ‹›æŠ•æ ‡å·¥ä½œå°ä¸»ç•Œé¢
- **DirectoryTree**: æ–‡æ¡£ç›®å½•æ ‘ç»„ä»¶
- **DocumentCanvas**: æ–‡æ¡£é¢„è§ˆå’Œç¼–è¾‘ç”»å¸ƒ
- **RiskList**: é£é™©ç‚¹è¯†åˆ«åˆ—è¡¨
- **SampleSidebar**: æ ¼å¼èŒƒæœ¬ä¾§è¾¹æ 
- **TemplateExtractPanel**: æ¨¡æ¿æå–é¢æ¿

#### 4. ç³»ç»Ÿè®¾ç½®

- **SystemSettings**: ç³»ç»Ÿè®¾ç½®é¡µé¢
  - LLM æ¨¡å‹é…ç½®
  - Embedding æœåŠ¡é…ç½®
  - Google CSE é…ç½®
  - æ£€ç´¢å‚æ•°é…ç½®
  - çˆ¬è™«é…ç½®

---

## æ•°æ®å­˜å‚¨

### PostgreSQL æ•°æ®åº“è¡¨ç»“æ„

#### 1. ç”¨æˆ·ä¸è®¤è¯

```sql
-- users è¡¨
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(100) UNIQUE NOT NULL,
    email VARCHAR(255) UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    role VARCHAR(50) DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 2. èŠå¤©ä¼šè¯

```sql
-- chat_sessions è¡¨
CREATE TABLE chat_sessions (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    title VARCHAR(500),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- chat_messages è¡¨
CREATE TABLE chat_messages (
    id SERIAL PRIMARY KEY,
    session_id INTEGER REFERENCES chat_sessions(id) ON DELETE CASCADE,
    role VARCHAR(50) NOT NULL,  -- 'user' or 'assistant'
    content TEXT NOT NULL,
    metadata JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 3. çŸ¥è¯†åº“

```sql
-- kb_categories è¡¨ï¼ˆçŸ¥è¯†åº“åˆ†ç±»ï¼‰
CREATE TABLE kb_categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- kb_documents è¡¨ï¼ˆçŸ¥è¯†åº“æ–‡æ¡£ï¼‰
CREATE TABLE kb_documents (
    id SERIAL PRIMARY KEY,
    kb_id INTEGER REFERENCES kb_categories(id) ON DELETE CASCADE,
    title VARCHAR(500) NOT NULL,
    source_type VARCHAR(50),  -- 'file', 'url', 'text'
    source_url TEXT,
    file_path TEXT,
    content_hash VARCHAR(64),  -- ç”¨äºå»é‡
    metadata JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- kb_chunks è¡¨ï¼ˆæ–‡æ¡£åˆ†å—ï¼‰
CREATE TABLE kb_chunks (
    id SERIAL PRIMARY KEY,
    doc_id INTEGER REFERENCES kb_documents(id) ON DELETE CASCADE,
    kb_id INTEGER,
    chunk_index INTEGER,
    content TEXT NOT NULL,
    content_vector TSVECTOR,  -- ç”¨äºå…¨æ–‡æ£€ç´¢
    metadata JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- åˆ›å»ºå…¨æ–‡æ£€ç´¢ç´¢å¼•
CREATE INDEX idx_kb_chunks_vector ON kb_chunks USING GIN(content_vector);
CREATE INDEX idx_kb_chunks_content_trgm ON kb_chunks USING GIN(content gin_trgm_ops);
```

#### 4. æ‹›æŠ•æ ‡é¡¹ç›®

```sql
-- tender_projects è¡¨ï¼ˆæ‹›æŠ•æ ‡é¡¹ç›®ï¼‰
CREATE TABLE tender_projects (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    name VARCHAR(500) NOT NULL,
    description TEXT,
    status VARCHAR(50),
    metadata JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- tender_documents è¡¨ï¼ˆæ‹›æŠ•æ ‡æ–‡æ¡£ï¼‰
CREATE TABLE tender_documents (
    id SERIAL PRIMARY KEY,
    project_id INTEGER REFERENCES tender_projects(id) ON DELETE CASCADE,
    file_name VARCHAR(500),
    file_path TEXT,
    doc_type VARCHAR(50),
    content JSONB,
    metadata JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 5. é™„ä»¶

```sql
-- attachments è¡¨
CREATE TABLE attachments (
    id UUID PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    original_filename VARCHAR(500),
    stored_filename VARCHAR(500),
    file_path TEXT,
    file_size INTEGER,
    mime_type VARCHAR(100),
    content_hash VARCHAR(64),
    metadata JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Milvus Lite å‘é‡å­˜å‚¨

#### Collection ç»“æ„

```python
# kb_chunks_dense collection
schema = {
    "fields": [
        {"name": "id", "type": "INT64", "is_primary": True, "auto_id": False},
        {"name": "kb_id", "type": "INT64"},
        {"name": "doc_id", "type": "INT64"},
        {"name": "chunk_index", "type": "INT64"},
        {"name": "dense_vector", "type": "FLOAT_VECTOR", "dim": 1024},  # ç»´åº¦å¯é…ç½®
    ]
}

# ç´¢å¼•é…ç½®
index_params = {
    "metric_type": "IP",  # Inner Product (å†…ç§¯)
    "index_type": "HNSW",
    "params": {"M": 16, "efConstruction": 200}
}
```

### æ–‡ä»¶å­˜å‚¨

| ç›®å½• | å†…å®¹ | è¯´æ˜ |
|------|------|------|
| `./data/app_settings.json` | åº”ç”¨è®¾ç½® | Embeddingã€Searchã€Retrievalã€Crawl é…ç½® |
| `./data/llm_models.json` | LLM æ¨¡å‹åˆ—è¡¨ | å¤š LLM æ¨¡å‹é…ç½® |
| `./data/embedding_providers.json` | Embedding æä¾›å•† | Embedding æœåŠ¡é…ç½® |
| `./data/search_usage.json` | æœç´¢é…é¢ | Google CSE æ—¥åº¦è®¡æ•° |
| `./data/milvus.db` | Milvus Lite æ•°æ®åº“ | å‘é‡ç´¢å¼•æ–‡ä»¶ |
| `./data/postgres/` | PostgreSQL æ•°æ® | æ•°æ®åº“æ–‡ä»¶ |
| `./storage/attachments/` | é™„ä»¶æ–‡ä»¶ | ç”¨æˆ·ä¸Šä¼ çš„é™„ä»¶ï¼ˆUUID æ–‡ä»¶åï¼‰ |
| `./storage/recordings/` | å½•éŸ³æ–‡ä»¶ | è¯­éŸ³å½•éŸ³æ–‡ä»¶ |
| `./storage/tender/` | æ‹›æŠ•æ ‡æ–‡ä»¶ | æ‹›æŠ•æ ‡é¡¹ç›®æ–‡ä»¶ |

---

## éƒ¨ç½²æ¶æ„

### Docker Compose æœåŠ¡

```yaml
services:
  # åç«¯æœåŠ¡
  backend:
    image: x-llm-backend:local
    ports: 9001:8000
    volumes:
      - ./data:/app/data
      - ./storage:/app/storage
    environment:
      - POSTGRES_HOST=postgres
      - MILVUS_LITE_PATH=/app/data/milvus.db
  
  # å‰ç«¯æœåŠ¡
  frontend:
    image: x-llm-frontend:local
    ports: 6173:5173
    depends_on: [backend]
  
  # PostgreSQL æ•°æ®åº“
  postgres:
    image: postgres:15-alpine
    ports: 5432:5432
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
    environment:
      - POSTGRES_DB=localgpt
      - POSTGRES_USER=localgpt
      - POSTGRES_PASSWORD=localgpt
```

### ç«¯å£æ˜ å°„

| æœåŠ¡ | å®¹å™¨ç«¯å£ | å®¿ä¸»ç«¯å£ | è¯´æ˜ |
|------|---------|---------|------|
| Frontend | 5173 | 6173 | React + Nginx |
| Backend | 8000 | 9001 | FastAPI + Uvicorn |
| PostgreSQL | 5432 | (å†…éƒ¨) | ä»…å®¹å™¨é—´è®¿é—® |

### æ•°æ®æŒä¹…åŒ–

æ‰€æœ‰æ•°æ®é€šè¿‡ Volume æ˜ å°„åˆ°å®¿ä¸»æœº `./data` å’Œ `./storage` ç›®å½•ï¼š

```
./data/
â”œâ”€â”€ app_settings.json          # åº”ç”¨è®¾ç½®
â”œâ”€â”€ llm_models.json            # LLM æ¨¡å‹é…ç½®
â”œâ”€â”€ embedding_providers.json   # Embedding é…ç½®
â”œâ”€â”€ search_usage.json          # æœç´¢é…é¢
â”œâ”€â”€ milvus.db                  # Milvus å‘é‡æ•°æ®åº“
â””â”€â”€ postgres/                  # PostgreSQL æ•°æ®ç›®å½•

./storage/
â”œâ”€â”€ attachments/               # èŠå¤©é™„ä»¶
â”œâ”€â”€ recordings/                # è¯­éŸ³å½•éŸ³
â””â”€â”€ tender/                    # æ‹›æŠ•æ ‡æ–‡ä»¶
```

---

## æ ¸å¿ƒåŠŸèƒ½æµç¨‹

### 1. èŠå¤©å¯¹è¯æµç¨‹

```
ç”¨æˆ·è¾“å…¥
   â†“
[å‰ç«¯] MessageInput
   â†“ POST /api/chat
[åç«¯] chat.py router
   â†“
[æœåŠ¡] llm_orchestrator.py
   â†“
[æ„å›¾] intent_parser.py â†’ è§£æç”¨æˆ·æ„å›¾
   â†“
[æ£€ç´¢å†³ç­–] æ˜¯å¦éœ€è¦æ£€ç´¢ï¼Ÿ
   â”œâ”€ éœ€è¦ â†’ rag_service.py
   â”‚   â”œâ”€ Google CSE æœç´¢ (å¯é€‰)
   â”‚   â”œâ”€ crawler æŠ“å–ç½‘é¡µ
   â”‚   â”œâ”€ kb_dao æŸ¥è¯¢çŸ¥è¯†åº“
   â”‚   â”œâ”€ pg_lexical è¯æ³•æ£€ç´¢
   â”‚   â”œâ”€ milvus_lite_store å‘é‡æ£€ç´¢
   â”‚   â””â”€ rrf.py èåˆç»“æœ
   â”‚
   â””â”€ ä¸éœ€è¦ â†’ ç›´æ¥è°ƒç”¨ LLM
       â†“
[LLM] llm_client.py â†’ è°ƒç”¨è¿œç¨‹ LLM API
   â†“
[å“åº”] Stream/Non-stream è¿”å›
   â†“
[å­˜å‚¨] chat_dao.py â†’ ä¿å­˜ä¼šè¯å’Œæ¶ˆæ¯
   â†“
[å‰ç«¯] MessageBubble æ¸²æŸ“å›ç­”
```

### 2. çŸ¥è¯†åº“å¯¼å…¥æµç¨‹

```
ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£
   â†“
[å‰ç«¯] ImportWizard
   â†“ POST /api/kb/{kb_id}/documents
[åç«¯] kb.py router
   â†“
[æœåŠ¡] kb_service.py
   â†“
[è§£æ] documents/parser.py â†’ è§£ææ–‡æ¡£å†…å®¹
   â”œâ”€ PDF â†’ pypdf + PyMuPDF
   â”œâ”€ DOCX â†’ python-docx
   â”œâ”€ PPTX â†’ python-pptx
   â””â”€ TXT/MD â†’ ç›´æ¥è¯»å–
       â†“
[åˆ†å—] segmenter/chunker.py â†’ åˆ‡åˆ†æ–‡æœ¬å—
   â†“
[å»é‡] cache/doc_cache.py â†’ æ£€æŸ¥å†…å®¹å“ˆå¸Œ
   â†“
[å­˜å‚¨] kb_dao.py
   â”œâ”€ PostgreSQL â†’ ä¿å­˜æ–‡æ¡£å’Œåˆ†å—
   â””â”€ tsvector â†’ åˆ›å»ºå…¨æ–‡æ£€ç´¢ç´¢å¼•
       â†“
[å‘é‡åŒ–] http_embedding_client.py â†’ è°ƒç”¨ Embedding API
   â†“
[å‘é‡å­˜å‚¨] milvus_lite_store.py â†’ å­˜å‚¨å‘é‡
   â†“
[å®Œæˆ] è¿”å›å¯¼å…¥ç»“æœ
```

### 3. æ‹›æŠ•æ ‡æ–‡æ¡£å¤„ç†æµç¨‹

```
ç”¨æˆ·ä¸Šä¼ æ‹›æ ‡æ–‡æ¡£
   â†“
[å‰ç«¯] TenderWorkspace
   â†“ POST /api/tender/projects/{project_id}/documents
[åç«¯] tender.py router
   â†“
[æœåŠ¡] tender_service.py
   â†“
[ç‰‡æ®µæå–] fragment/fragment_extractor.py
   â”œâ”€ PDF â†’ pdf_layout_extractor.py
   â”œâ”€ DOCX â†’ docx_body_indexer.py
   â””â”€ æå–æ ¼å¼èŒƒæœ¬
       â†“
[ç‰‡æ®µåŒ¹é…] fragment/fragment_matcher.py
   â”œâ”€ åŒ¹é…å†…ç½®æ¨¡æ¿
   â””â”€ è¯†åˆ«å…³é”®å­—æ®µ
       â†“
[LLM åˆ†æ] tender/snippet_llm.py
   â”œâ”€ é£é™©è¯†åˆ«
   â”œâ”€ éœ€æ±‚æå–
   â””â”€ åˆè§„æ£€æŸ¥
       â†“
[è¯­ä¹‰å¤§çº²] semantic_outline/outline_synthesis_service.py
   â”œâ”€ æå–æ–‡æ¡£ç»“æ„
   â””â”€ ç”Ÿæˆè¯­ä¹‰å¤§çº²
       â†“
[å­˜å‚¨] tender_dao.py â†’ ä¿å­˜é¡¹ç›®æ•°æ®
   â†“
[å‰ç«¯] æ˜¾ç¤ºåˆ†æç»“æœ
```

### 4. æ¨¡æ¿æå–ä¸åº”ç”¨æµç¨‹

```
ç”¨æˆ·é€‰æ‹©æ¨¡æ¿æå–
   â†“
[å‰ç«¯] TemplateExtractPanel
   â†“ POST /api/template/extract
[åç«¯] template_analysis.py router
   â†“
[ç¼–æ’] template_extract/orchestrator_service.py
   â†“
[å€™é€‰å¬å›] candidate_recall_service.py
   â”œâ”€ å…¨æ–‡åŒ¹é…
   â””â”€ æ¨¡ç³ŠåŒ¹é…
       â†“
[LLM è·¨åº¦] llm_span_service.py
   â”œâ”€ LLM å®šä½å…³é”®æ®µè½
   â””â”€ æå–ç²¾ç¡®èŒƒå›´
       â†“
[è·¨åº¦ç²¾ç‚¼] span_refiner_service.py
   â”œâ”€ å»é™¤å†—ä½™
   â””â”€ åˆå¹¶è¿ç»­æ®µè½
       â†“
[è¦†ç›–ä¿æŠ¤] coverage_guard_service.py
   â””â”€ ç¡®ä¿å®Œæ•´æ€§
       â†“
[æ¨¡æ¿ç”Ÿæˆ] template/template_renderer.py
   â”œâ”€ åˆ†ææ ·å¼
   â”œâ”€ ç”Ÿæˆæ¨¡æ¿
   â””â”€ ä¿å­˜æ¨¡æ¿æ–‡ä»¶
       â†“
[åº”ç”¨æ¨¡æ¿] export/docx_exporter.py
   â”œâ”€ å¤åˆ¶æ¨¡æ¿
   â”œâ”€ å¡«å……å†…å®¹
   â””â”€ åº”ç”¨æ ·å¼
       â†“
[å¯¼å‡º] ç”Ÿæˆ DOCX æ–‡ä»¶
```

---

## API æ¥å£æ¦‚è§ˆ

### è®¤è¯ä¸ç”¨æˆ·

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| POST | `/api/auth/login` | ç”¨æˆ·ç™»å½• |
| POST | `/api/auth/register` | ç”¨æˆ·æ³¨å†Œ |
| POST | `/api/auth/logout` | ç”¨æˆ·ç™»å‡º |
| GET | `/api/auth/me` | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ |

### èŠå¤©å¯¹è¯

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| POST | `/api/chat` | å‘é€èŠå¤©æ¶ˆæ¯ |
| GET | `/api/chat/sessions` | è·å–ä¼šè¯åˆ—è¡¨ |
| GET | `/api/chat/sessions/{session_id}` | è·å–ä¼šè¯è¯¦æƒ… |
| DELETE | `/api/chat/sessions/{session_id}` | åˆ é™¤ä¼šè¯ |
| GET | `/api/chat/sessions/{session_id}/messages` | è·å–ä¼šè¯æ¶ˆæ¯ |

### çŸ¥è¯†åº“

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| GET | `/api/kb/categories` | è·å–çŸ¥è¯†åº“åˆ†ç±»åˆ—è¡¨ |
| POST | `/api/kb/categories` | åˆ›å»ºçŸ¥è¯†åº“åˆ†ç±» |
| DELETE | `/api/kb/categories/{kb_id}` | åˆ é™¤çŸ¥è¯†åº“åˆ†ç±» |
| GET | `/api/kb/{kb_id}/documents` | è·å–çŸ¥è¯†åº“æ–‡æ¡£åˆ—è¡¨ |
| POST | `/api/kb/{kb_id}/documents` | ä¸Šä¼ æ–‡æ¡£åˆ°çŸ¥è¯†åº“ |
| DELETE | `/api/kb/{kb_id}/documents/{doc_id}` | åˆ é™¤æ–‡æ¡£ |
| GET | `/api/kb/{kb_id}/chunks` | è·å–æ–‡æ¡£åˆ†å— |

### LLM ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| GET | `/api/llm/models` | è·å– LLM æ¨¡å‹åˆ—è¡¨ |
| POST | `/api/llm/models` | æ·»åŠ  LLM æ¨¡å‹ |
| PUT | `/api/llm/models/{model_id}` | æ›´æ–° LLM æ¨¡å‹ |
| DELETE | `/api/llm/models/{model_id}` | åˆ é™¤ LLM æ¨¡å‹ |
| POST | `/api/llm/models/{model_id}/set-default` | è®¾ç½®é»˜è®¤æ¨¡å‹ |

### Embedding ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| GET | `/api/embedding-providers` | è·å– Embedding æä¾›å•†åˆ—è¡¨ |
| POST | `/api/embedding-providers` | æ·»åŠ  Embedding æä¾›å•† |
| PUT | `/api/embedding-providers/{provider_id}` | æ›´æ–°æä¾›å•† |
| DELETE | `/api/embedding-providers/{provider_id}` | åˆ é™¤æä¾›å•† |

### åº”ç”¨è®¾ç½®

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| GET | `/api/app-settings` | è·å–åº”ç”¨è®¾ç½® |
| PUT | `/api/app-settings` | æ›´æ–°åº”ç”¨è®¾ç½® |
| GET | `/api/app-settings/google-cse` | è·å– Google CSE é…ç½® |
| PUT | `/api/app-settings/google-cse` | æ›´æ–° Google CSE é…ç½® |

### æ‹›æŠ•æ ‡

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| GET | `/api/tender/projects` | è·å–é¡¹ç›®åˆ—è¡¨ |
| POST | `/api/tender/projects` | åˆ›å»ºé¡¹ç›® |
| GET | `/api/tender/projects/{project_id}` | è·å–é¡¹ç›®è¯¦æƒ… |
| DELETE | `/api/tender/projects/{project_id}` | åˆ é™¤é¡¹ç›® |
| POST | `/api/tender/projects/{project_id}/documents` | ä¸Šä¼ æ–‡æ¡£ |
| POST | `/api/tender/projects/{project_id}/analyze` | åˆ†ææ–‡æ¡£ |
| GET | `/api/tender/projects/{project_id}/risks` | è·å–é£é™©åˆ—è¡¨ |

### æ¨¡æ¿

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| POST | `/api/template/extract` | æå–æ¨¡æ¿ |
| POST | `/api/template/analyze` | åˆ†ææ¨¡æ¿ |
| POST | `/api/template/apply` | åº”ç”¨æ¨¡æ¿ |
| GET | `/api/template/list` | è·å–æ¨¡æ¿åˆ—è¡¨ |

### ASR è¯­éŸ³

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| WS | `/api/asr/ws` | å®æ—¶è¯­éŸ³è½¬å†™ WebSocket |
| POST | `/api/asr/transcribe` | éŸ³é¢‘æ–‡ä»¶è½¬å†™ |
| GET | `/api/recordings` | è·å–å½•éŸ³åˆ—è¡¨ |
| DELETE | `/api/recordings/{recording_id}` | åˆ é™¤å½•éŸ³ |

### é™„ä»¶

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| POST | `/api/attachments/upload` | ä¸Šä¼ é™„ä»¶ |
| GET | `/api/attachments/{attachment_id}` | è·å–é™„ä»¶ä¿¡æ¯ |
| DELETE | `/api/attachments/{attachment_id}` | åˆ é™¤é™„ä»¶ |

### å¯¼å‡º

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| POST | `/api/export/docx` | å¯¼å‡ºä¸º DOCX |
| POST | `/api/export/pdf` | å¯¼å‡ºä¸º PDF |

### å¥åº·æ£€æŸ¥

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| GET | `/health` | å¥åº·æ£€æŸ¥ |
| GET | `/api/health` | API å¥åº·æ£€æŸ¥ |

---

## é…ç½®æ–‡ä»¶è¯´æ˜

### 1. LLM æ¨¡å‹é…ç½® (`llm_models.json`)

```json
{
  "models": [
    {
      "id": "gpt-4",
      "name": "GPT-4",
      "base_url": "https://api.openai.com",
      "endpoint_path": "/v1/chat/completions",
      "model": "gpt-4",
      "api_key": "sk-xxx",
      "is_default": true,
      "parameters": {
        "temperature": 0.7,
        "max_tokens": 2000
      }
    },
    {
      "id": "qwen",
      "name": "é€šä¹‰åƒé—®",
      "base_url": "http://localhost:11434",
      "endpoint_path": "/api/chat",
      "model": "qwen:14b",
      "is_default": false
    }
  ]
}
```

### 2. Embedding é…ç½® (`embedding_providers.json`)

```json
{
  "providers": [
    {
      "id": "openai",
      "name": "OpenAI Embeddings",
      "base_url": "https://api.openai.com",
      "endpoint_path": "/v1/embeddings",
      "model": "text-embedding-ada-002",
      "api_key": "sk-xxx",
      "dimension": 1536,
      "is_active": true
    },
    {
      "id": "bge-m3",
      "name": "BGE-M3 Local",
      "base_url": "http://localhost:8002",
      "endpoint_path": "/v1/embeddings",
      "model": "bge-m3",
      "dimension": 1024,
      "supports_sparse": true,
      "is_active": false
    }
  ]
}
```

### 3. åº”ç”¨è®¾ç½® (`app_settings.json`)

```json
{
  "embedding": {
    "provider_id": "openai",
    "batch_size": 10,
    "timeout": 30
  },
  "search": {
    "google_cse": {
      "api_key": "xxx",
      "cx": "xxx",
      "daily_warn": 100,
      "daily_limit": 500,
      "max_urls": 5,
      "results_per_query": 30
    }
  },
  "retrieval": {
    "top_k": 10,
    "lexical_weight": 0.5,
    "dense_weight": 0.5,
    "rrf_k": 60,
    "similarity_threshold": 0.5
  },
  "crawler": {
    "timeout": 15,
    "blocked_domains": ["facebook.com"],
    "delay_min": 0.6,
    "delay_max": 1.8,
    "domain_cooldown": 2.5
  },
  "chunking": {
    "chunk_size": 1800,
    "chunk_overlap": 200
  }
}
```

---

## ç¯å¢ƒå˜é‡

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `POSTGRES_HOST` | `localhost` | PostgreSQL ä¸»æœº |
| `POSTGRES_PORT` | `5432` | PostgreSQL ç«¯å£ |
| `POSTGRES_DB` | `localgpt` | æ•°æ®åº“å |
| `POSTGRES_USER` | `localgpt` | æ•°æ®åº“ç”¨æˆ· |
| `POSTGRES_PASSWORD` | `localgpt` | æ•°æ®åº“å¯†ç  |
| `MILVUS_LITE_PATH` | `/app/data/milvus.db` | Milvus æ•°æ®åº“è·¯å¾„ |
| `APP_SETTINGS_PATH` | `/app/data/app_settings.json` | åº”ç”¨è®¾ç½®è·¯å¾„ |
| `LLM_STORE_PATH` | `/app/data/llm_models.json` | LLM æ¨¡å‹é…ç½®è·¯å¾„ |
| `SEARCH_USAGE_STORAGE` | `/app/data/search_usage.json` | æœç´¢é…é¢å­˜å‚¨è·¯å¾„ |
| `GOOGLE_CSE_API_KEY` | - | Google CSE API Key |
| `GOOGLE_CSE_CX` | - | Google CSE CX ID |
| `LOCAL_LLM_BASE_URL` | `http://localhost:8001` | é»˜è®¤ LLM æœåŠ¡åœ°å€ |

---

## æ‰©å±•ä¸å®šåˆ¶

### 1. æ·»åŠ æ–°çš„ LLM æ¨¡å‹

åœ¨å‰ç«¯ "ç³»ç»Ÿè®¾ç½®" â†’ "LLM æ¨¡å‹" ä¸­æ·»åŠ ï¼Œæˆ–ç›´æ¥ç¼–è¾‘ `data/llm_models.json`ã€‚

### 2. æ·»åŠ æ–°çš„ Embedding æœåŠ¡

åœ¨å‰ç«¯ "ç³»ç»Ÿè®¾ç½®" â†’ "Embedding æœåŠ¡" ä¸­æ·»åŠ ï¼Œæˆ–ç›´æ¥ç¼–è¾‘ `data/embedding_providers.json`ã€‚

### 3. è‡ªå®šä¹‰æ–‡æ¡£è§£æå™¨

åœ¨ `backend/app/services/documents/parser.py` ä¸­æ·»åŠ æ–°çš„è§£æå™¨ç±»ã€‚

### 4. è‡ªå®šä¹‰æ£€ç´¢ç­–ç•¥

ä¿®æ”¹ `backend/app/services/retrieval/retriever.py` ä¸­çš„æ£€ç´¢é€»è¾‘ã€‚

### 5. è‡ªå®šä¹‰ Prompt æ¨¡æ¿

ç¼–è¾‘ `backend/app/services/prompt_templates.py` ä¸­çš„æç¤ºè¯æ¨¡æ¿ã€‚

---

## æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–

- ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
- ä½¿ç”¨ `tsvector` å’Œ `pg_trgm` ä¼˜åŒ–å…¨æ–‡æ£€ç´¢
- å®šæœŸæ‰§è¡Œ `VACUUM ANALYZE` ä¼˜åŒ–è¡¨

### 2. å‘é‡æ£€ç´¢ä¼˜åŒ–

- è°ƒæ•´ Milvus HNSW å‚æ•° (M, efConstruction)
- æ ¹æ®æ•°æ®è§„æ¨¡é€‰æ‹©åˆé€‚çš„ç´¢å¼•ç±»å‹
- ä½¿ç”¨æ‰¹é‡æ’å…¥å‡å°‘ I/O

### 3. ç¼“å­˜ç­–ç•¥

- ä½¿ç”¨ Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼ˆå¯é€‰ï¼‰
- å¯ç”¨ HTTP å®¢æˆ·ç«¯è¿æ¥æ± 
- ç¼“å­˜ Embedding ç»“æœ

### 4. å¹¶å‘æ§åˆ¶

- ä½¿ç”¨ PostgreSQL è¿æ¥æ±  (psycopg-pool)
- é™åˆ¶ LLM API å¹¶å‘è¯·æ±‚æ•°
- çˆ¬è™«ä½¿ç”¨å¼‚æ­¥ I/O å’ŒåŸŸåçº§é™æµ

---

## å®‰å…¨æ€§

### 1. è®¤è¯ä¸æˆæƒ

- JWT Token è®¤è¯
- åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)
- å¯†ç ä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨

### 2. API å®‰å…¨

- CORS é™åˆ¶
- è¯·æ±‚é¢‘ç‡é™åˆ¶
- è¾“å…¥éªŒè¯ä¸ SQL æ³¨å…¥é˜²æŠ¤

### 3. æ•°æ®å®‰å…¨

- API Key åŠ å¯†å­˜å‚¨
- æ•æ„Ÿé…ç½®ä¸è®°å½•æ—¥å¿—
- æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶ (é»˜è®¤ 20MB)

---

## ç›‘æ§ä¸æ—¥å¿—

### 1. åº”ç”¨æ—¥å¿—

- åç«¯ä½¿ç”¨ Python `logging` æ¨¡å—
- æ—¥å¿—çº§åˆ«ï¼šDEBUG, INFO, WARNING, ERROR
- æ—¥å¿—ä½ç½®ï¼šæ ‡å‡†è¾“å‡º (Docker logs)

### 2. è¯·æ±‚æ—¥å¿—

- ä½¿ç”¨ `request_logger.py` è®°å½•æ‰€æœ‰ API è¯·æ±‚
- åŒ…å«è¯·æ±‚è·¯å¾„ã€æ–¹æ³•ã€çŠ¶æ€ç ã€è€—æ—¶

### 3. å¥åº·æ£€æŸ¥

- `/health` ç«¯ç‚¹æ£€æŸ¥æœåŠ¡çŠ¶æ€
- æ£€æŸ¥æ•°æ®åº“è¿æ¥
- æ£€æŸ¥å‘é‡æ•°æ®åº“è¿æ¥

---

## æ•…éšœæ’æŸ¥

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ PostgreSQL å®¹å™¨çŠ¶æ€
docker ps | grep postgres

# æŸ¥çœ‹ PostgreSQL æ—¥å¿—
docker logs localgpt-postgres

# æµ‹è¯•æ•°æ®åº“è¿æ¥
docker exec -it localgpt-postgres psql -U localgpt -d localgpt
```

### 2. Milvus å‘é‡æ£€ç´¢å¤±è´¥

```bash
# æ£€æŸ¥ Milvus æ•°æ®åº“æ–‡ä»¶
ls -lh ./data/milvus.db

# æŸ¥çœ‹åç«¯æ—¥å¿—
docker logs localgpt-backend | grep milvus
```

### 3. LLM API è°ƒç”¨è¶…æ—¶

- æ£€æŸ¥ LLM æœåŠ¡æ˜¯å¦å¯è¾¾
- å¢åŠ  `timeout` é…ç½®
- æŸ¥çœ‹åç«¯æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

### 4. çŸ¥è¯†åº“å¯¼å…¥å¤±è´¥

- æ£€æŸ¥æ–‡æ¡£æ ¼å¼æ˜¯å¦æ”¯æŒ
- æŸ¥çœ‹æ–‡ä»¶å¤§å°æ˜¯å¦è¶…é™
- æ£€æŸ¥ Embedding æœåŠ¡æ˜¯å¦æ­£å¸¸

---

## å¼€å‘æŒ‡å—

### åç«¯å¼€å‘

```bash
cd backend
pip install -r requirements.txt

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# è¿è¡Œæµ‹è¯•
pytest tests/
```

### å‰ç«¯å¼€å‘

```bash
cd frontend
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build
```

### æ•°æ®åº“è¿ç§»

```bash
cd backend

# åˆ›å»ºè¿ç§»
alembic revision --autogenerate -m "description"

# æ‰§è¡Œè¿ç§»
alembic upgrade head

# å›æ»šè¿ç§»
alembic downgrade -1
```

---

## å‚è€ƒèµ„æ–™

- FastAPI æ–‡æ¡£: https://fastapi.tiangolo.com
- React æ–‡æ¡£: https://react.dev
- PostgreSQL æ–‡æ¡£: https://www.postgresql.org/docs/
- Milvus æ–‡æ¡£: https://milvus.io/docs
- Google CSE æ–‡æ¡£: https://developers.google.com/custom-search

---

## æ›´æ–°æ—¥å¿—

### ç‰ˆæœ¬ 0.2.0 (2025-12-18)

- âœ… å®Œæ•´çš„å¤š LLM æ”¯æŒ
- âœ… æ··åˆ RAG (Postgres + Milvus)
- âœ… æ‹›æŠ•æ ‡æ–‡æ¡£æ™ºèƒ½å¤„ç†
- âœ… æ¨¡æ¿æå–ä¸åº”ç”¨
- âœ… å®æ—¶è¯­éŸ³è½¬å†™
- âœ… çŸ¥è¯†åº“åˆ†ç±»ç®¡ç†
- âœ… é™„ä»¶ä¸Šä¼ ä¸åˆ†æ
- âœ… ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025-12-18
**ç³»ç»Ÿç‰ˆæœ¬**: 0.2.0
**ç»´æŠ¤å›¢é˜Ÿ**: äº¿æ—äº¿é—®å¼€å‘å›¢é˜Ÿ

