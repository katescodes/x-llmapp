# LLM Orchestrator 快速入门指南

## 5 分钟快速体验

### 1. 启动服务

**使用 Docker Compose**（推荐）：
```bash
cd /aidata/x-llmapp1

# 首次启动或代码有更新时，重新构建
docker-compose build

# 启动所有服务（后端 + 前端 + 数据库）
docker-compose up -d

# 查看运行状态
docker-compose ps

# 查看日志
docker-compose logs -f backend
docker-compose logs -f frontend
```

**服务访问地址**：
- 前端：`http://localhost:6173`
- 后端：`http://localhost:9001`
- API 文档：`http://localhost:9001/docs`

**停止服务**：
```bash
docker-compose down
```

---

### 2. 启用编排器

在前端左侧边栏找到：

```
☐ 🎯 启用智能编排器（实验性）
```

**勾选** 复选框。

此时下方会出现**答案详尽度**选项：

```
● 精简    ○ 标准    ○ 详细
```

默认选择 **"标准"**。

---

### 3. 第一个测试：知识综述

**输入问题**：
```
简要介绍一下 Docker 技术
```

**点击发送**，等待 2-5 秒。

**预期效果**：

答案会以**折叠卡片**形式显示，而非传统的文本块：

```
▼ 理解确认
   你想了解 Docker 技术的基本概念和核心特性。

▼ 核心答案
   Docker 是一个开源的容器化平台...
   （展开显示完整内容）

▶ 核心概念
   （点击展开：镜像、容器、仓库等术语解释）

▶ 示例与案例
   （点击展开：实际使用示例）

▶ 下一步建议
   （点击展开：学习路径、推荐资源）
```

💡 **可选补充信息（非必需）**：
- 你的使用场景是开发测试还是生产部署？
- 需要与 Kubernetes 集成吗？

---

### 4. 第二个测试：排障场景

**输入问题**：
```
Python 虚拟环境启动失败，报错 "command not found: python3"
```

**预期效果**：

```
▼ 理解确认
   你遇到 Python 虚拟环境启动失败的问题...

▼ 核心答案
   这个问题通常是 PATH 配置不正确或 Python 未安装...

▼ 检查清单
   1. 检查 Python 是否已安装：which python3
   2. 检查 PATH 环境变量：echo $PATH
   3. 检查虚拟环境激活脚本是否存在
   4. 检查 shell 类型（bash/zsh）

▶ 执行步骤
   （逐步解决方案）

▶ 常见陷阱
   （易错点和注意事项）
```

---

### 5. 第三个测试：详尽度切换

#### 测试 5.1：精简模式

1. 在左侧边栏选择 **"精简"**
2. 输入：`什么是 RESTful API？`
3. 观察：答案明显更短，模块更少

#### 测试 5.2：详细模式

1. 在左侧边栏选择 **"详细"**
2. 输入**相同问题**：`什么是 RESTful API？`
3. 观察：答案更长，包含更多例子和深入解释

**对比**：
- **精简**：2-3 段核心答案 + 最多 4 个模块
- **详细**：5-8 段核心答案 + 6-10 个模块，多个例子

---

### 6. 第四个测试：文本关键词覆盖 UI

**输入问题**（包含关键词）：
```
给我详细展开说明一下 Kubernetes 的架构，多举些例子
```

**预期效果**：
- 即使 UI 设置为 "标准"，因为文本包含 "详细展开" 和 "多举些例子"，会自动识别为 **detailed** 模式
- 答案会非常详细，包含多个实例

**验证**：
- 打开浏览器开发者工具 → Network → 找到 `/api/chat/stream` 请求
- 查看响应的 `result` 事件
- 检查 `orchestrator_meta.detail_level` 是否为 `"detailed"`

---

### 7. 对比：关闭编排器

1. **取消勾选** "🎯 启用智能编排器"
2. 输入问题：`什么是 Docker？`
3. 观察：答案显示为传统的文本块，无折叠卡片

**这验证了向后兼容性**：未启用编排器时，系统按原有方式工作。

---

## 关键概念速查

### 意图类型（8 种）

| 意图类型       | 说明                   | 典型问题示例                       |
|----------------|------------------------|------------------------------------|
| information    | 获取信息/知识综述      | "什么是 X？"                       |
| howto          | 如何做某事/教程        | "如何配置 X？"                     |
| decision       | 选型/决策              | "选 A 还是 B？"                    |
| troubleshoot   | 排障/调试              | "X 报错怎么办？"                   |
| writing        | 写作/生成文档          | "帮我写一份 X 方案"                |
| compute        | 计算/推理              | "计算 X 的结果"                    |
| research       | 研究/深度分析          | "分析 X 的发展趋势"                |
| other          | 其他                   | 无法明确分类的问题                 |

### 标准模块（16 种）

| 模块 ID        | 中文标题       | 说明                               |
|----------------|----------------|------------------------------------|
| align_summary  | 理解确认       | 复述用户问题（必需）               |
| core_answer    | 核心答案       | 直接回答核心问题（必需）           |
| timeline       | 时间线         | 按时间顺序梳理事件                 |
| concepts       | 核心概念       | 关键术语/概念解释                  |
| controversy    | 争议与口径     | 不同观点/流派/争议点               |
| examples       | 示例与案例     | 具体例子/真实案例                  |
| comparison     | 对比矩阵       | 方案 A vs 方案 B 表格对比          |
| checklist      | 检查清单       | 排障/检查用的步骤清单              |
| steps          | 执行步骤       | 操作指南/步骤（1、2、3...）        |
| pitfalls       | 常见陷阱       | 易错点/坑/注意事项                 |
| next_steps     | 下一步建议     | 后续行动/学习路径                  |
| sources        | 参考来源       | 引用文档/链接（用 [1][2] 标注）   |
| verification   | 核对路径       | 如何验证答案/查证方法              |
| alternatives   | 替代方案       | 其他可行方案                       |
| prerequisites  | 前置条件       | 需要先具备的知识/环境              |
| outline        | 大纲结构       | 写作用的文档大纲                   |

### 详尽度级别

| 级别     | 核心答案长度 | 模块数量 | 例子数量 | 适用场景                 |
|----------|--------------|----------|----------|--------------------------|
| brief    | 2-3 段       | 3-4      | 0-1      | 快速获取结论             |
| normal   | 3-5 段       | 4-6      | 1-2      | 平衡的详细程度（默认）   |
| detailed | 5-8 段       | 6-10     | 3-4      | 深入学习、全面了解       |

---

## 常见问题

### Q1: 为什么有时候没有折叠卡片？

**A**: 可能的原因：
1. 未勾选 "启用智能编排器"
2. LLM 未按要求输出 `## 标题` 格式（质量不够）
3. 后端出错（查看后端日志）

**排查**：
- 检查浏览器控制台（F12 → Console）是否有错误
- 检查 Network → `/api/chat/stream` 的响应是否包含 `sections` 字段

---

### Q2: 详尽度切换不生效？

**A**: 检查以下几点：
1. 确保已勾选 "启用智能编排器"
2. 文本关键词优先级高于 UI 设置（如果问题中包含 "简短" 或 "详细"，会覆盖 UI）
3. 检查 `orchestrator_meta.detail_level` 是否符合预期

---

### Q3: 可以自定义模块吗？

**A**: 可以，修改后端文件：

**修改模块定义**：
```python
# backend/app/schemas/orchestrator.py
MODULE_TITLES = {
    # ... 保留原有模块 ...
    "my_custom_module": "我的自定义模块",
}
```

**修改意图蓝图**：
```python
INTENT_BLUEPRINTS = {
    IntentType.INFORMATION: [
        "align_summary",
        "core_answer",
        "my_custom_module",  # 添加自定义模块
        "next_steps",
    ],
}
```

**修改 Prompt**：
```python
# backend/app/services/orchestrator/prompts.py
MODULAR_SYSTEM_PROMPT = """
...
2. **可选模块**（根据 blueprint_modules 选择）：
   - **我的自定义模块**（my_custom_module）：[描述用途]
   ...
"""
```

---

### Q4: 如何关闭编排器？

**A**: 两种方式：

**方式 1：前端关闭**（推荐）
- 取消勾选 "🎯 启用智能编排器"

**方式 2：后端全局关闭**
```python
# backend/app/routers/chat.py
# 在 _chat_endpoint_impl 中强制关闭
use_orchestrator = False  # 强制不使用编排器
```

---

### Q5: 支持多语言吗？

**A**: 当前仅支持中文 Prompt。

如需英文支持，需要：
1. 翻译 `prompts.py` 中的 Prompt
2. 修改 `MODULE_TITLES` 为英文
3. 前端组件增加国际化支持

---

## 下一步

- 📖 阅读完整测试用例：`docs/LLM_ORCHESTRATOR_TESTS.md`
- 📋 查看实施报告：`LLM_ORCHESTRATOR_IMPLEMENTATION.md`
- 🔧 调优 Prompt：`backend/app/services/orchestrator/prompts.py`
- 🎨 自定义 UI 样式：`frontend/src/components/ModularAnswer.tsx`

---

## 技巧与最佳实践

### 提问技巧

**❌ 不推荐**：
```
告诉我关于 Docker 的信息
```
- 太泛，难以生成有针对性的模块

**✅ 推荐**：
```
我想学习 Docker，请介绍它的核心概念和基本使用步骤
```
- 明确目标，编排器会输出 "核心概念" + "执行步骤" 模块

---

### 利用详尽度控制

**场景 1：快速查询**
- 选择 "精简"
- 问题示例：`简要说明 RESTful API 是什么`
- 适合快速获取结论

**场景 2：深入学习**
- 选择 "详细"
- 问题示例：`详细讲解 Kubernetes 的调度机制，多给些例子`
- 适合全面了解

**场景 3：排障**
- 保持 "标准"
- 问题示例：`Nginx 启动失败，日志显示 "address already in use"`
- 会自动生成检查清单和排障步骤

---

### 充分利用 Followups

当答案包含黄色提示框时：

```
💡 可选补充信息（非必需）
- 你的使用场景是开发环境还是生产环境？
- 预计访问量是多少？（小/中/大）
```

**可以**：
- 在下一轮对话中补充信息（如 "是生产环境，预计中等访问量"）
- 获得更精准的建议

**也可以**：
- 忽略提示，直接使用当前答案
- Followups 不会阻塞答案生成

---

## 实验性功能：组合使用

### 编排器 + 联网搜索

1. 勾选 "启用联网搜索"
2. 勾选 "启用智能编排器"
3. 输入问题：`2025 年 AI 领域的最新进展`

**效果**：
- 编排器会识别为 "research" 意图
- 生成 "时间线" + "争议与口径" + "参考来源" 模块
- 参考来源会引用联网搜索的结果

---

### 编排器 + 知识库检索

1. 选择知识库（如 "技术文档库"）
2. 勾选 "启用智能编排器"
3. 输入问题：`根据我们的技术文档，推荐一个容器编排方案`

**效果**：
- 编排器会识别为 "decision" 意图
- 生成 "对比矩阵" + "下一步建议" 模块
- 答案会引用知识库中的文档

---

## 祝你使用愉快！🎉

如有问题，请参考：
- 测试用例：`docs/LLM_ORCHESTRATOR_TESTS.md`
- 实施报告：`LLM_ORCHESTRATOR_IMPLEMENTATION.md`
- 后端日志：`backend/logs/`
- 前端控制台：浏览器 F12 → Console
