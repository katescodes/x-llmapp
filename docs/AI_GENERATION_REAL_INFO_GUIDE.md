# AI生成标书 - 真实信息填充指南

## 📋 问题描述

AI自动生成标书时，必须使用从招标文件中抽取的真实项目信息和企业资料，**严禁编造**任何客户信息（招标人名称、联系人、联系电话等）或公司信息。

## ✅ 解决方案

系统已进行以下优化，确保AI生成时使用真实信息：

### 1. 扩展项目信息展示

**位置**：`backend/app/services/generation/prompt_builder.py`

**改进内容**：
- ✅ 扩展了 `_format_project_info` 方法
- ✅ 新增展示字段：
  - 项目编号、采购方式、预算金额、最高限价
  - **招标人/采购人信息**：招标人、采购人名称、代理机构、联系人、联系电话、联系邮箱
  - **投标信息**：投标截止时间、开标时间、开标地点、递交地址、保证金
  - **项目范围**：项目范围和概况描述

**效果**：AI能够看到完整的项目信息，确保在生成时有足够的真实数据可用。

### 2. 强化Prompt约束

#### System Prompt（`tender_system.md`）

新增 **"🚨 核心原则"** 部分，明确规定：

```markdown
## 🚨 核心原则（必须严格遵守）

### ⚠️ 禁止编造信息
**绝对不得编造任何真实信息**，包括但不限于：
- ❌ 招标人/采购人名称、联系人、联系电话
- ❌ 投标人（我方）公司名称、法定代表人、联系方式
- ❌ 资质证书编号、业绩合同编号等具体数据
- ❌ 项目编号、预算金额、时间节点等具体信息

### ✅ 必须使用真实信息
1. **项目信息**：项目名称、招标人、联系方式等**必须**使用提供的真实数据
2. **企业信息**：公司名称、资质、业绩等**必须**从企业资料中提取
3. **信息缺失**：如果信息不完整，使用【待补充：具体字段名】标记，**严禁编造**
```

#### User Prompt（`tender_user.md`）

- ✅ 在项目信息后添加**关键提示**，强调信息来自真实招标文件
- ✅ 在企业资料部分强调**必须使用**真实资料，严禁编造公司信息
- ✅ 在输出要求中增加**"信息真实性要求"**作为第一优先级
- ✅ 在各章节类型指导中都强调使用真实信息

### 3. 信息缺失处理

当信息不完整时，AI会：
- ✅ 使用 `【待补充：具体字段名】` 标记，如：
  - `【待补充：招标人名称】`
  - `【待补充：公司名称】`
  - `【待补充：资质证书】`
- ✅ **绝不会**用"XX公司"、"某某项目"等模糊占位符
- ✅ **绝不会**编造电话号码、证书编号等具体数据

## 🎯 使用指南

### 确保信息完整性

#### 1. 项目信息抽取

在"步骤2：提取信息" → "项目信息"中：
- ✅ 确保已抽取**招标人/采购人名称**
- ✅ 确保已抽取**联系人和联系电话**
- ✅ 确保已抽取**项目名称、编号、预算**等基本信息

**查看示例**：
```json
{
  "project_name": "慧眼图形智能识别系统（软件）",
  "contact_person": "黄先生、孔女士",
  "contact_phone": "89723216、89723975",
  "budget": "90万元",
  "bid_deadline": "2025年12月17日上午8:50",
  ...
}
```

#### 2. 企业资料上传

在"步骤1：上传文档"中：
- ✅ 上传**公司简介**文档（包含公司名称、成立时间、注册资金等）
- ✅ 上传**资质证书**（营业执照、行业资质等）
- ✅ 上传**业绩案例**（历史项目、合同等）
- ✅ 上传**技术文档**（技术方案、产品介绍等）

系统会自动检索这些资料，并在AI生成时提供给模型。

#### 3. AI生成标书

在"步骤3：AI生成标书"中：
- ✅ 点击章节节点的"生成内容"按钮
- ✅ AI会自动使用项目信息和企业资料生成内容
- ✅ 如果信息不足，会显示 `【待补充：XXX】` 标记

### 检查生成内容

生成后，请检查：

1. **项目信息是否真实**
   - ✅ 招标人名称是否来自招标文件
   - ✅ 联系人、联系电话是否准确
   - ✅ 项目名称、预算等是否正确

2. **公司信息是否真实**
   - ✅ 公司名称是否来自企业资料
   - ✅ 资质证书是否真实存在
   - ✅ 业绩案例是否来自真实项目

3. **标记处理**
   - ⚠️ 如果看到 `【待补充：XXX】`，说明该信息缺失
   - ✅ 手动补充缺失信息
   - ✅ 或者上传相关资料后重新生成

## 🔍 验证示例

### ✅ 正确示例（使用真实信息）

```html
<p>致：杭州市XX局（采购人）</p>
<p>根据贵单位发布的"慧眼图形智能识别系统（软件）"项目（采购编号：XXXX）的招标文件要求...</p>
<p>我方（【待补充：公司名称】）作为合格的投标人...</p>
<p>联系人：黄先生、孔女士</p>
<p>联系电话：89723216、89723975</p>
```

**说明**：
- ✅ 招标人、项目名称来自真实招标文件
- ✅ 联系人、电话来自真实招标文件
- ✅ 公司名称缺失，使用【待补充】标记，**没有编造**

### ❌ 错误示例（编造信息）

```html
<p>致：XX市政府采购中心</p>
<p>根据贵单位发布的招标文件...</p>
<p>我方（某某科技有限公司）作为合格的投标人...</p>
<p>联系人：张经理</p>
<p>联系电话：138XXXX1234</p>
```

**问题**：
- ❌ "XX市政府采购中心" - 编造的招标人名称
- ❌ "某某科技有限公司" - 编造的公司名称
- ❌ "张经理"、"138XXXX1234" - 编造的联系方式

**现在的系统不会生成这样的内容！**

## 📊 项目信息字段说明

系统现在会提取并展示以下所有字段（如果在招标文件中存在）：

| 字段类别 | 字段名 | 说明 | 示例 |
|---------|--------|------|------|
| **核心信息** | project_name | 项目名称 | "慧眼图形智能识别系统（软件）" |
| | project_number | 项目编号 | "2025-XXXX" |
| | procurement_method | 采购方式 | "竞争性磋商" |
| | budget | 预算金额 | "90万元" |
| **招标人信息** | tenderee | 招标人 | "杭州市XX局" |
| | owner_name | 采购人名称 | "杭州市XX局" |
| | agency_name | 代理机构 | "XX招标代理有限公司" |
| | contact_person | 联系人 | "黄先生、孔女士" |
| | contact_phone | 联系电话 | "89723216、89723975" |
| | contact_email | 联系邮箱 | "xxx@example.com" |
| **投标信息** | bid_deadline | 投标截止时间 | "2025年12月17日上午8:50" |
| | bid_opening_time | 开标时间 | "2025年12月17日上午8:50" |
| | bid_opening_location | 开标地点 | "杭州市文二路240号..." |
| | submission_address | 递交地址 | "杭州市文二路240号..." |
| **项目范围** | project_scope | 项目范围 | "通过对图片和文字..." |

**所有这些信息都会传递给AI，确保生成时有足够的真实数据可用。**

## ⚙️ 技术实现

### 代码位置

1. **Prompt构建器**：`backend/app/services/generation/prompt_builder.py`
   - `_format_project_info()` - 格式化项目信息
   - `_build_tender_system_prompt()` - 构建系统提示词
   - `_build_tender_user_prompt()` - 构建用户提示词

2. **Prompt模板**：
   - `backend/app/services/generation/prompts/tender_system.md` - 系统角色定义
   - `backend/app/services/generation/prompts/tender_user.md` - 用户输入模板

3. **内容生成服务**：`backend/app/services/tender_service.py`
   - `_generate_section_content()` - 生成章节内容主方法
   - `_build_tender_project_context()` - 构建项目上下文

### 数据流

```
招标文件 
  ↓ (AI抽取)
tender_project_info 表
  ↓ (查询data_json)
项目信息字典 (project_info)
  ↓ (_format_project_info)
格式化的项目信息文本
  ↓ (注入到Prompt)
LLM (带严格约束)
  ↓ (生成)
标书章节内容（使用真实信息）
```

## 🎉 效果总结

优化后的系统确保：

✅ **完整展示**：所有项目信息字段都会传递给AI
✅ **强制约束**：多层次的Prompt约束，严禁编造
✅ **清晰标记**：信息缺失时使用标准化的【待补充】标记
✅ **真实准确**：所有具体信息（人名、电话、公司名等）都来自真实数据
✅ **可追溯**：用户可以清楚看到哪些信息是真实的，哪些需要补充

## 📞 技术支持

如果生成的内容仍然包含编造的信息，请：

1. 检查项目信息是否完整抽取
2. 检查企业资料是否已上传
3. 提供具体的问题章节和内容
4. 联系技术团队进行排查

---

**最后更新**：2026-01-13  
**版本**：v1.0

