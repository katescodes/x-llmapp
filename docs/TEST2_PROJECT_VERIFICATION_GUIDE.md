# "æµ‹è¯•2"é¡¹ç›®å®¡æ ¸å¿«é€ŸéªŒè¯æŒ‡å—

## ç³»ç»Ÿå·²ä¿®å¤ï¼Œç°åœ¨å¯ä»¥æµ‹è¯•äº†ï¼

### ä¿®å¤å†…å®¹

1. **å®¡æ ¸é€»è¾‘é‡æ„**ï¼š
   - âœ… æ”¯æŒæ— è§„åˆ™åŒ…çš„åŸºç¡€è¯„ä¼°
   - âœ… æ”¯æŒè‡ªå®šä¹‰è§„åˆ™ + åŸºç¡€è¯„ä¼°ç»„åˆ
   - âœ… è‡ªåŠ¨é€‰æ‹©å®¡æ ¸æ¨¡å¼
   - âœ… ä¿®å¤æ•°æ®åº“å­—æ®µæ˜ å°„é”™è¯¯

2. **å‰ç«¯UIä¼˜åŒ–**ï¼š
   - âœ… æ›´æ–°è§„åˆ™åŒ…é€‰æ‹©æç¤º
   - âœ… æ·»åŠ å®¡æ ¸æ¨¡å¼è¯´æ˜

### æµ‹è¯•æ­¥éª¤

#### æ–¹å¼1ï¼šå‰ç«¯UIæµ‹è¯•ï¼ˆæ¨èï¼‰

1. **æ‰“å¼€ç³»ç»Ÿ**
   - è®¿é—®å‰ç«¯é¡µé¢
   - é€‰æ‹©"æµ‹è¯•2"é¡¹ç›®

2. **è¿›å…¥å®¡æ ¸Tabï¼ˆStep 6ï¼‰**
   - æ³¨æ„æ–°çš„UIæç¤ºï¼š
     ```
     ğŸ’¡ å®¡æ ¸æ¨¡å¼è¯´æ˜
     â€¢ ä¸é€‰è§„åˆ™åŒ…ï¼šåŸºç¡€è¯„ä¼°æ¨¡å¼ - å¿«é€Ÿæ£€æŸ¥
     â€¢ é€‰æ‹©è§„åˆ™åŒ…ï¼šè¯¦ç»†å®¡æ ¸æ¨¡å¼ - å…¨é¢å®¡æ ¸
     ```

3. **æµ‹è¯•åœºæ™¯Aï¼šä¸é€‰è§„åˆ™åŒ…**
   - ä¸å‹¾é€‰ä»»ä½•è§„åˆ™åŒ…
   - ç‚¹å‡»"å¼€å§‹å®¡æ ¸"
   - é¢„æœŸï¼šä½¿ç”¨åŸºç¡€è¯„ä¼°æ¨¡å¼ï¼Œè¯„ä¼°69ä¸ªæ‹›æ ‡è¦æ±‚

4. **æµ‹è¯•åœºæ™¯Bï¼šé€‰æ‹©è§„åˆ™åŒ…**
   - å‹¾é€‰ä¸€ä¸ªæˆ–å¤šä¸ªè§„åˆ™åŒ…
   - ç‚¹å‡»"å¼€å§‹å®¡æ ¸"
   - é¢„æœŸï¼šä½¿ç”¨è‡ªå®šä¹‰è§„åˆ™ + åŸºç¡€è¯„ä¼°

5. **æŸ¥çœ‹å®¡æ ¸ç»“æœ**
   - æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºå®¡æ ¸ç»“æœ
   - æŸ¥çœ‹PASS/WARN/FAILç»Ÿè®¡
   - ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†å®¡æ ¸é¡¹

#### æ–¹å¼2ï¼šAPIæµ‹è¯•

```bash
# åœºæ™¯Aï¼šä¸ä¼ è§„åˆ™åŒ…ï¼ˆåŸºç¡€è¯„ä¼°æ¨¡å¼ï¼‰
curl -X POST http://localhost:8000/api/apps/tender/projects/tp_259c05d1979e402db656a58a930467e2/review/run \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"bidder_name": "123"}'

# åœºæ™¯Bï¼šä¼ å…¥è§„åˆ™åŒ…ï¼ˆè‡ªå®šä¹‰è§„åˆ™æ¨¡å¼ï¼‰
curl -X POST http://localhost:8000/api/apps/tender/projects/tp_259c05d1979e402db656a58a930467e2/review/run \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "bidder_name": "123",
    "custom_rule_pack_ids": ["4ff8f82c-d188-4ac1-aaff-a7cf9090da28"]
  }'
```

#### æ–¹å¼3ï¼šDockerå‘½ä»¤æµ‹è¯•ï¼ˆæœ€å¿«ï¼‰

```bash
docker exec localgpt-backend python3 -c "
import asyncio, sys
sys.path.insert(0, '/app')

async def test():
    from app.services.db.postgres import _get_pool
    from app.works.tender.review_v3_service import ReviewV3Service
    
    pool = _get_pool()
    svc = ReviewV3Service(pool=pool, llm_orchestrator=None)
    
    result = await svc.run_review_v3(
        project_id='tp_259c05d1979e402db656a58a930467e2',
        bidder_name='123',
        model_id=None,
        run_id=None,
        custom_rule_pack_ids=None
    )
    
    print(f'âœ… å®¡æ ¸æˆåŠŸï¼')
    print(f'æ¨¡å¼: {result.get(\"review_mode\")}')
    print(f'æ‹›æ ‡è¦æ±‚: {result.get(\"requirement_count\")}')
    print(f'æŠ•æ ‡å“åº”: {result.get(\"response_count\")}')
    print(f'è‡ªå®šä¹‰è§„åˆ™: {result.get(\"rule_count\")}')
    print(f'å®¡æ ¸ç»“æœ: {result.get(\"finding_count\")}')
    print(f'PASS: {result.get(\"pass_count\")} | WARN: {result.get(\"warn_count\")} | FAIL: {result.get(\"fail_count\")}')

asyncio.run(test())
"
```

### é¢„æœŸç»“æœ

**æµ‹è¯•2é¡¹ç›®æ•°æ®ï¼š**
- æ‹›æ ‡è¦æ±‚ï¼š69æ¡
- æŠ•æ ‡å“åº”ï¼š12æ¡
- å…±äº«è§„åˆ™åŒ…ï¼š6ä¸ª

**é¢„æœŸå®¡æ ¸ç»“æœï¼ˆè‡ªåŠ¨åŠ è½½è§„åˆ™åŒ…ï¼‰ï¼š**
```
æ¨¡å¼: CUSTOM_RULES
æ‹›æ ‡è¦æ±‚: 69
æŠ•æ ‡å“åº”: 12
è‡ªå®šä¹‰è§„åˆ™: 7
å®¡æ ¸ç»“æœ: 69æ¡
PASS: 17 | WARN: 2 | FAIL: 50
```

**ç»“æœè§£è¯»ï¼š**
- âœ… æ‰€æœ‰69ä¸ªæ‹›æ ‡è¦æ±‚éƒ½è¢«è¯„ä¼°ï¼ˆæ— é—æ¼ï¼‰
- âœ… 17ä¸ªé€šè¿‡ï¼šæœ‰å¯¹åº”çš„æŠ•æ ‡å“åº”ä¸”ç¬¦åˆè¦æ±‚
- âš ï¸ 2ä¸ªè­¦å‘Šï¼šå“åº”ä¸å®Œæ•´æˆ–éç¡¬æ€§è¦æ±‚æœªå®Œå…¨æ»¡è¶³
- âŒ 50ä¸ªä¸åˆæ ¼ï¼šä¸»è¦æ˜¯ç¡¬æ€§è¦æ±‚æ²¡æœ‰å¯¹åº”çš„æŠ•æ ‡å“åº”

### å¸¸è§é—®é¢˜

**Q1ï¼šå®¡æ ¸ç»“æœä¸ºä»€ä¹ˆæœ‰50ä¸ªFAILï¼Ÿ**
Aï¼šå› ä¸ºæŠ•æ ‡å“åº”åªæœ‰12æ¡ï¼Œæ— æ³•è¦†ç›–æ‰€æœ‰69ä¸ªæ‹›æ ‡è¦æ±‚ã€‚æœªå“åº”çš„ç¡¬æ€§è¦æ±‚è¢«æ ‡è®°ä¸ºFAILã€‚

**Q2ï¼šå¦‚æœä¸é€‰è§„åˆ™åŒ…ä¼šæ€æ ·ï¼Ÿ**
Aï¼šç³»ç»Ÿä¼šä½¿ç”¨åŸºç¡€è¯„ä¼°æ¨¡å¼ï¼Œåªæ£€æŸ¥æ¯ä¸ªæ‹›æ ‡è¦æ±‚æ˜¯å¦æœ‰æŠ•æ ‡å“åº”ï¼Œä¸åº”ç”¨å¤æ‚çš„è§„åˆ™é€»è¾‘ã€‚

**Q3ï¼šä¸ºä»€ä¹ˆæ˜¾ç¤º"æ¨¡å¼: CUSTOM_RULES"ä½†æˆ‘æ²¡æœ‰é€‰è§„åˆ™åŒ…ï¼Ÿ**
Aï¼šç³»ç»Ÿè‡ªåŠ¨åŠ è½½äº†æ‰€æœ‰å…±äº«è§„åˆ™åŒ…ã€‚å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰è§„åˆ™åŒ…ï¼Œä¼šæ˜¾ç¤º"BASIC_REQUIREMENTS_ONLY"ã€‚

**Q4ï¼šå®¡æ ¸ç»“æœä¿å­˜åœ¨å“ªé‡Œï¼Ÿ**
Aï¼šä¿å­˜åœ¨ `tender_review_items` è¡¨ä¸­ï¼Œå¯ä»¥é€šè¿‡å‰ç«¯æŸ¥çœ‹æˆ–SQLæŸ¥è¯¢ï¼š
```sql
SELECT * FROM tender_review_items 
WHERE project_id = 'tp_259c05d1979e402db656a58a930467e2' 
  AND bidder_name = '123';
```

### éªŒè¯æ¸…å•

- [ ] å¯ä»¥ä¸é€‰è§„åˆ™åŒ…è¿›è¡Œå®¡æ ¸
- [ ] å¯ä»¥é€‰æ‹©è§„åˆ™åŒ…è¿›è¡Œå®¡æ ¸
- [ ] å®¡æ ¸ç»“æœæ˜¾ç¤ºæ­£ç¡®çš„ç»Ÿè®¡æ•°å­—
- [ ] å¯ä»¥æŸ¥çœ‹è¯¦ç»†çš„å®¡æ ¸é¡¹
- [ ] UIæç¤ºæ¸…æ™°æ˜“æ‡‚
- [ ] å®¡æ ¸æ¨¡å¼è‡ªåŠ¨é€‰æ‹©æ­£ç¡®

### ä¸‹ä¸€æ­¥å»ºè®®

å¦‚æœæµ‹è¯•é€šè¿‡ï¼Œå»ºè®®ï¼š

1. **åˆ›å»ºæ›´å¤šæµ‹è¯•é¡¹ç›®**ï¼š
   - ä¸Šä¼ ä¸åŒç±»å‹çš„æ‹›æ ‡/æŠ•æ ‡æ–‡ä»¶
   - æµ‹è¯•ä¸åŒç»´åº¦çš„è¦æ±‚å’Œå“åº”

2. **ä¼˜åŒ–è‡ªå®šä¹‰è§„åˆ™**ï¼š
   - åœ¨"è‡ªå®šä¹‰è§„åˆ™ç®¡ç†"é¡µé¢åˆ›å»ºæ›´å¤šè§„åˆ™åŒ…
   - é’ˆå¯¹ç‰¹å®šé¡¹ç›®ç±»å‹è®¾è®¡è§„åˆ™

3. **æŸ¥çœ‹å®¡æ ¸æŠ¥å‘Š**ï¼š
   - å¯¼å‡ºå®¡æ ¸ç»“æœ
   - åˆ†æå¸¸è§çš„ä¸åˆæ ¼é¡¹
   - æ”¹è¿›æŠ•æ ‡æ–‡ä»¶è´¨é‡

---

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
docker logs localgpt-backend 2>&1 | tail -100
```

