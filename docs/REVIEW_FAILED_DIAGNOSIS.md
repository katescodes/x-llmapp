# 审核失败问题诊断

## 问题描述
项目4（测试4）的审核状态显示 `failed`

## 根本原因
**项目4的知识库中没有任何文档**

### 详细诊断
```sql
-- 项目4知识库ID: 84ff45f7f3944293beefacb1323eb58f
-- 文档数量: 0
-- 版本数量: 0
```

**错误信息**：
```
Review failed: RETRIEVAL_MODE=NEW_ONLY failed: 0 
(mode=NEW_ONLY, provider=new, query=投标文件格式 投标文件组成 目)
```

这表明检索时返回了0个结果，因为知识库中根本没有文档。

## 解决步骤

### 1. 上传投标文件
在项目4中上传投标文件（bid类型）：
- 进入项目4（测试4）
- 点击"上传文件"或"导入资产"
- 选择投标文件（.docx 或 .pdf）
- 确认上传成功

### 2. 等待文档入库
文档上传后需要入库到知识库：
- 小文件（<5MB）：约30秒
- 大文件（>10MB）：可能需要1-2分钟
- 可以在页面上看到"入库中"或"已完成"状态

### 3. 验证文档已入库
```sql
-- 检查知识库中的文档
SELECT 
    COUNT(DISTINCT d.id) as doc_count
FROM kb_documents d
WHERE d.kb_id = '84ff45f7f3944293beefacb1323eb58f';
```

如果 `doc_count > 0`，说明文档已入库。

### 4. 重新执行审核
- 在项目4中点击"开始审核"按钮
- 系统会自动检索文档并执行审核
- 等待审核完成

## 注意事项

1. **必须上传投标文件**：审核功能需要对比招标文件和投标文件，如果没有投标文件，无法执行审核
2. **文件类型**：确保上传的是投标文件（kind=bid），而不是招标文件（kind=tender）
3. **文档入库**：上传后要等待入库完成，不要立即点击审核
4. **NEW_ONLY模式**：当前系统使用新的DocStore检索模式，必须确保文档已入库

## 其他可能的失败原因

如果上传了文档但仍然失败，可能是：
- 文档格式不支持（目前支持 .docx、.pdf）
- 文档内容为空或无法解析
- 文档入库失败（检查日志）
- DocStore检索服务异常

可以通过以下命令检查日志：
```bash
docker logs localgpt-backend 2>&1 | grep -i "docstore\|retrieval\|review" | tail -50
```

