════════════════════════════════════════════════════════════════════════════
端到端 Smoke 测试闸门 - 完整文件清单
════════════════════════════════════════════════════════════════════════════

创建日期: 2025-12-19
状态: ✅ 已完成并验证

═══════════════════════════════════════════════════════════════════════════
核心文件
═══════════════════════════════════════════════════════════════════════════

📁 测试数据 (testdata/)
├── tender_sample.pdf              [752 KB]  招标文件样例
├── bid_sample.docx                [33 MB]   投标文件样例
├── rules.yaml                     [254 B]   自定义规则样例
└── README.md                      [新建]    测试数据说明

🔧 Smoke 脚本 (scripts/smoke/)
├── __init__.py                    [新建]    模块初始化
├── tender_e2e.py                  [16 KB]   端到端测试主脚本 ✓ 可执行
└── README.md                      [9.8 KB]  详细使用文档

🧪 Pytest 测试 (backend/)
├── pytest.ini                     [新建]    Pytest 配置文件
└── tests/smoke/
    ├── __init__.py                [新建]    测试模块初始化
    └── test_tender_e2e.py         [2.7 KB]  Pytest 封装测试

📦 前端集成 (frontend/)
└── package.json                   [已更新]  新增 smoke:tender 脚本

📖 文档文件 (根目录)
├── SMOKE_TEST.md                  [新建]    快速指南
├── QUICK_START_SMOKE.md           [新建]    一键开始
├── .smoke-test-setup-complete.txt [新建]    设置完成标记
└── .smoke-test-verification.sh    [新建]    验证脚本 ✓ 可执行

═══════════════════════════════════════════════════════════════════════════
测试覆盖的 API 接口
═══════════════════════════════════════════════════════════════════════════

✓ POST   /api/auth/login
✓ POST   /api/apps/tender/projects
✓ POST   /api/apps/tender/projects/{id}/assets/import
✓ POST   /api/apps/tender/projects/{id}/extract/project-info
✓ GET    /api/apps/tender/runs/{run_id}
✓ POST   /api/apps/tender/projects/{id}/extract/risks
✓ POST   /api/apps/tender/projects/{id}/directory/generate
✓ POST   /api/apps/tender/projects/{id}/directory/auto-fill-samples (可选)
✓ POST   /api/apps/tender/projects/{id}/directory/apply-format-template (可选)
✓ POST   /api/apps/tender/projects/{id}/review/run
✓ GET    /api/apps/tender/projects/{id}/export/docx
✓ GET    /api/apps/tender/projects/{id}/delete-plan
✓ DELETE /api/apps/tender/projects/{id}

═══════════════════════════════════════════════════════════════════════════
测试特性
═══════════════════════════════════════════════════════════════════════════

✅ 完整流程覆盖 (创建 → 分析 → 审查 → 导出)
✅ 异步任务等待 (自动轮询 run_id 直到完成)
✅ 错误处理 (失败时打印详细错误并 exit(1))
✅ 进度显示 (实时显示任务进度百分比)
✅ 可选步骤 (支持 SKIP_OPTIONAL 跳过非必要步骤)
✅ 自动清理 (测试完成后删除项目，可通过 KEEP_PROJECT 保留)
✅ 环境变量配置 (BASE_URL、TOKEN、文件路径等)
✅ 彩色日志输出 (✓ 成功 / ✗ 错误 / ⚠ 警告 / ℹ 信息)
✅ Pytest 集成 (支持 pytest -m smoke 运行)
✅ 超时保护 (每个步骤都有合理的超时时间)
✅ 详细文档 (README、快速指南、API 说明)

═══════════════════════════════════════════════════════════════════════════
运行方式
═══════════════════════════════════════════════════════════════════════════

方式 1 - 直接运行 (推荐):
    $ python scripts/smoke/tender_e2e.py

方式 2 - 使用 pytest:
    $ cd backend && pytest -m smoke

方式 3 - 从前端运行:
    $ cd frontend && npm run smoke:tender

方式 4 - 带配置:
    $ BASE_URL=http://192.168.1.100:9001 \
      SKIP_OPTIONAL=true \
      python scripts/smoke/tender_e2e.py

═══════════════════════════════════════════════════════════════════════════
验收检查清单
═══════════════════════════════════════════════════════════════════════════

□ 1. 所有文件已创建 (运行 .smoke-test-verification.sh 验证)
□ 2. Python 语法正确 (python -m py_compile scripts/smoke/tender_e2e.py)
□ 3. 服务已启动 (docker compose up -d --build)
□ 4. 健康检查通过 (curl http://localhost:9001/health)
□ 5. Smoke 测试通过 (python scripts/smoke/tender_e2e.py)
□ 6. Pytest 测试通过 (cd backend && pytest -m smoke)

═══════════════════════════════════════════════════════════════════════════
不包含的内容 (按用户要求)
═══════════════════════════════════════════════════════════════════════════

✗ 不修改任何现有业务逻辑
✗ 不修改现有 API 接口
✗ 不修改前端 UI 页面
✗ 不改变数据库 schema
✗ 不影响现有功能运行

═══════════════════════════════════════════════════════════════════════════
环境变量配置
═══════════════════════════════════════════════════════════════════════════

BASE_URL              后端地址 (默认: http://localhost:9001)
TOKEN                 认证令牌 (可选，留空则自动登录)
USERNAME              用户名 (默认: admin@example.com)
PASSWORD              密码 (默认: admin123)
TENDER_FILE           招标文件 (默认: testdata/tender_sample.pdf)
BID_FILE              投标文件 (默认: testdata/bid_sample.docx)
RULES_FILE            规则文件 (默认: testdata/rules.yaml)
FORMAT_TEMPLATE_FILE  格式模板 (可选)
SKIP_OPTIONAL         跳过可选步骤 (默认: false)
KEEP_PROJECT          保留测试项目 (默认: false)

═══════════════════════════════════════════════════════════════════════════
验证结果
═══════════════════════════════════════════════════════════════════════════

✅ 文件存在性检查: 通过 (8/8 文件)
✅ Python 语法检查: 通过 (2/2 脚本)
✅ 文件权限检查: 通过 (脚本可执行)
✅ 测试数据检查: 通过 (样例文件完整)
✅ 文档完整性: 通过 (README 齐全)

═══════════════════════════════════════════════════════════════════════════
下一步操作
═══════════════════════════════════════════════════════════════════════════

1. 启动服务:
   $ docker compose up -d --build

2. 运行 Smoke 测试:
   $ python scripts/smoke/tender_e2e.py

3. 验证通过后，即可进入下一步开发！

═══════════════════════════════════════════════════════════════════════════
文档位置
═══════════════════════════════════════════════════════════════════════════

• 快速开始: QUICK_START_SMOKE.md
• 完整指南: SMOKE_TEST.md
• 详细文档: scripts/smoke/README.md
• 测试数据: testdata/README.md

═══════════════════════════════════════════════════════════════════════════
支持与帮助
═══════════════════════════════════════════════════════════════════════════

如遇问题:
1. 查看详细文档
2. 检查服务日志: docker compose logs backend
3. 保留项目调试: KEEP_PROJECT=true python scripts/smoke/tender_e2e.py
4. 查看 run 状态: 访问 /api/apps/tender/runs/{run_id}

═══════════════════════════════════════════════════════════════════════════
完成时间: 2025-12-19
版本: 1.0.0
═══════════════════════════════════════════════════════════════════════════
